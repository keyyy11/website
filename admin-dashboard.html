<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard ‚Äì Aeronas Aerocraft</title>
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body class="theme-admin">
    <!-- Sidebar -->
    <aside class="admin-sidebar">
        <div class="admin-sidebar-header">
            <img src="assets/images/Logo-Icon-Only.png" alt="Logo" class="admin-sidebar-logo">
            <h2>Admin</h2>
        </div>
        <nav class="admin-nav">
            <a href="#" class="admin-nav-item active" data-section="dashboard">
                <span class="nav-icon">üìä</span>
                Dashboard
            </a>
            <a href="#" class="admin-nav-item" data-section="news">
                <span class="nav-icon">üì∞</span>
                News
            </a>
            <a href="#" class="admin-nav-item" data-section="settings">
                <span class="nav-icon">‚öôÔ∏è</span>
                Settings
            </a>
        </nav>
        <div class="admin-sidebar-footer">
            <a href="index.html" class="admin-nav-item">
                <span class="nav-icon">üè†</span>
                Back to Site
            </a>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="admin-main">
        <div class="admin-topbar">
            <h1 class="admin-page-title">Dashboard</h1>
            <div class="admin-topbar-actions">
                <span class="admin-user" id="adminUser">Admin</span>
                <button class="admin-btn-small" id="logoutBtn">Logout</button>
            </div>
        </div>

        <!-- Dashboard Section -->
        <section class="admin-section active" id="dashboard">
            <div class="admin-stats-grid">
                <div class="admin-stat-card">
                    <div class="stat-icon">üì∞</div>
                    <div class="stat-content">
                        <h3>News Articles</h3>
                        <div class="stat-number" id="newsCount">0</div>
                        <div class="stat-label">Total articles</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- News Section -->
        <section class="admin-section" id="news">
            <div class="admin-card">
                <div class="admin-card-header">
                    <h2>News Articles</h2>
                    <button class="admin-btn-primary" id="addNewsBtn">Add New Article</button>
                </div>
                <div class="admin-news-grid" id="newsGrid">
                    <!-- News articles will be loaded here -->
                </div>
            </div>
        </section>

        <!-- Settings Section -->
        <section class="admin-section" id="settings">
            <div class="admin-card">
                <h2>Settings</h2>
                <div class="admin-settings-form">
                    <div class="form-group">
                        <label>Site Name</label>
                        <input type="text" class="admin-input" value="Aeronas Aerocraft" id="siteName">
                    </div>
                    <div class="form-group">
                        <label>Contact Email</label>
                        <input type="email" class="admin-input" value="admin@aeronasgrp.com" id="contactEmail">
                    </div>
                    <div class="form-group">
                        <label>Contact Phone</label>
                        <input type="text" class="admin-input" value="07-4450444" id="contactPhone">
                    </div>
                    <button class="admin-btn-primary" id="saveSettingsBtn">Save Settings</button>
                </div>
            </div>
        </section>
    </main>

    <!-- Add News Modal -->
    <div class="admin-modal" id="newsModal">
        <div class="admin-modal-content">
            <div class="admin-modal-header">
                <h2>Add New Article</h2>
                <button class="admin-modal-close" id="closeModal">&times;</button>
            </div>
            <form class="admin-modal-form" id="newsForm">
                <div class="form-group">
                    <label for="newsTitle">Title</label>
                    <input type="text" id="newsTitle" class="admin-input" required>
                </div>
                <div class="form-group">
                    <label for="newsContent">Content</label>
                    <textarea id="newsContent" class="admin-input" required></textarea>
                </div>
                <div class="form-group">
                    <label for="newsImageUrl">Image URL</label>
                    <input type="url" id="newsImageUrl" class="admin-input" required>
                </div>
                <div class="form-group">
                    <label for="newsDate">Date</label>
                    <input type="date" id="newsDate" class="admin-input" required>
                </div>
                <div class="admin-modal-actions">
                    <button type="button" class="admin-btn-small" id="cancelBtn">Cancel</button>
                    <button type="submit" class="admin-btn-primary">Save Article</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, getDocs, addDoc, deleteDoc, doc, orderBy, query } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { firebaseConfig } from './assets/js/firebase-config.js';

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Check authentication
        onAuthStateChanged(auth, (user) => {
            if (!user) {
                window.location.href = 'admin-login.html';
            } else {
                document.getElementById('adminUser').textContent = user.email;
                loadNews();
            }
        });

        // Logout
        document.getElementById('logoutBtn').addEventListener('click', async () => {
            await signOut(auth);
            window.location.href = 'admin-login.html';
        });

        // Navigation
        document.querySelectorAll('.admin-nav-item[data-section]').forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                const section = item.dataset.section;
                
                // Update active nav
                document.querySelectorAll('.admin-nav-item').forEach(nav => nav.classList.remove('active'));
                item.classList.add('active');
                
                // Show section
                document.querySelectorAll('.admin-section').forEach(sec => sec.classList.remove('active'));
                document.getElementById(section).classList.add('active');
                
                // Update page title
                document.querySelector('.admin-page-title').textContent = section.charAt(0).toUpperCase() + section.slice(1);
            });
        });

        // Load news articles
        async function loadNews() {
            const grid = document.getElementById('newsGrid');
            grid.innerHTML = '';

            try {
                const newsRef = collection(db, 'news');
                const q = query(newsRef, orderBy('date', 'desc'));
                const querySnapshot = await getDocs(q);

                // Update count
                document.getElementById('newsCount').textContent = querySnapshot.size;

                querySnapshot.forEach((docItem) => {
                    const article = docItem.data();
                    const articleCard = document.createElement('div');
                    articleCard.className = 'admin-news-item';
                    articleCard.innerHTML = `
                        <div class="news-item-image" style="background-image: url('${article.imageUrl || ''}')"></div>
                        <div class="news-item-content">
                            <h3>${article.title || 'Untitled'}</h3>
                            <p>${article.content ? article.content.substring(0, 100) + '...' : ''}</p>
                            <div class="news-item-actions">
                                <button class="admin-btn-small delete-news" data-id="${docItem.id}">Delete</button>
                            </div>
                        </div>
                    `;
                    grid.appendChild(articleCard);
                });

                // Delete handlers
                document.querySelectorAll('.delete-news').forEach(btn => {
                    btn.addEventListener('click', async () => {
                        if (confirm('Are you sure you want to delete this article?')) {
                            await deleteDoc(doc(db, 'news', btn.dataset.id));
                            loadNews();
                        }
                    });
                });
            } catch (error) {
                console.error('Error loading news:', error);
            }
        }

        // Modal handlers
        document.getElementById('addNewsBtn').addEventListener('click', () => {
            document.getElementById('newsModal').style.display = 'flex';
            document.getElementById('newsForm').reset();
        });

        document.getElementById('closeModal').addEventListener('click', () => {
            document.getElementById('newsModal').style.display = 'none';
        });

        document.getElementById('cancelBtn').addEventListener('click', () => {
            document.getElementById('newsModal').style.display = 'none';
        });

        // Add news form
        document.getElementById('newsForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const title = document.getElementById('newsTitle').value;
            const content = document.getElementById('newsContent').value;
            const imageUrl = document.getElementById('newsImageUrl').value;
            const date = document.getElementById('newsDate').value;

            try {
                await addDoc(collection(db, 'news'), {
                    title,
                    content,
                    imageUrl,
                    date: new Date(date)
                });
                
                document.getElementById('newsModal').style.display = 'none';
                loadNews();
            } catch (error) {
                alert('Error adding article: ' + error.message);
            }
        });

        // Save settings
        document.getElementById('saveSettingsBtn').addEventListener('click', () => {
            alert('Settings saved! (Note: This would save to Firestore in a full implementation)');
        });
    </script>
</body>
</html>


