<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Aeronas Aerocraft</title>
    <link rel="icon" type="image/png" href="assets/images/Logo-Icon-Only.png">
    <link rel="shortcut icon" type="image/png" href="assets/images/Logo-Icon-Only.png">
    <link rel="stylesheet" href="assets/css/style.css">
    <script>
        // Suppress touch event warnings by ensuring passive listeners
        (function() {
            if (typeof EventTarget !== 'undefined') {
                const originalAddEventListener = EventTarget.prototype.addEventListener;
                EventTarget.prototype.addEventListener = function(type, listener, options) {
                    // For touch events, ensure passive is set if not explicitly provided
                    if ((type === 'touchstart' || type === 'touchmove') && !options) {
                        options = { passive: true };
                    } else if ((type === 'touchstart' || type === 'touchmove') && typeof options === 'object' && !('passive' in options)) {
                        options = Object.assign({}, options, { passive: true });
                    }
                    return originalAddEventListener.call(this, type, listener, options);
                };
            }
        })();

        // Suppress console warnings for touch events from external sources
        (function() {
            const originalWarn = console.warn;
            const originalError = console.error;
            
            console.warn = function(...args) {
                const message = args.join(' ');
                // Filter out touch event warnings from external sources
                if (message.includes('non-passive event listener') && 
                    (message.includes('touchmove') || message.includes('touchstart')) &&
                    (message.includes('main.js') || message.includes('init_embed.js'))) {
                    return; // Suppress this warning
                }
                originalWarn.apply(console, args);
            };
            
            console.error = function(...args) {
                const message = args.join(' ');
                // Filter out touch event errors from external sources
                if (message.includes('non-passive event listener') && 
                    (message.includes('touchmove') || message.includes('touchstart')) &&
                    (message.includes('main.js') || message.includes('init_embed.js'))) {
                    return; // Suppress this error
                }
                originalError.apply(console, args);
            };
        })();
    </script>
</head>
<body class="theme-dark">
    <div class="scroll-dark-overlay" id="scrollDarkOverlay"></div>

    <!-- Header -->
    <header class="site-header">
        <div class="header-left">
            <a href="index.html" class="brand-mark">
                <img src="assets/images/Logo-Icon-Only.png" alt="Logo" class="logo">
                <span class="brand-text">Aeronas Aerocraft</span>
            </a>
        </div>

        <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Toggle menu">
            <span></span>
            <span></span>
            <span></span>
        </button>

        <nav class="header-nav" id="headerNav">
            <a href="index.html">Home</a>
            <div class="nav-dropdown">
                <a href="aircraft.html">Aircraft</a>
                <div class="dropdown-menu">
                    <a href="aircraft.html#manufacturing">Manufacturing</a>
                    <a href="technology.html">Technology</a>
                    <a href="compliance.html">Compliance</a>
                </div>
            </div>
            <a href="about.html">About</a>
            <a href="services.html">Careers</a>
            <a href="news.html">News</a>
            <!-- <a href="event.html">Event</a> -->
            <a href="contact.html" class="nav-mobile-contact">Contact Us</a>
        </nav>

        <div class="header-right">
            <a href="contact.html" class="nav-cta">Contact Us</a>
        </div>
    </header>

    <!-- Main Content -->
    <main class="home-page">
        <!-- Hero Section -->
        <section class="hero-industrial">
            <div class="hero-inner hero-centered">
                <img src="assets/images/Asset2@2x.png" alt="Aeronas Aerocraft" class="hero-title-image">
                <p class="hero-subtitle hero-subtitle-centered">
                    AERONAS is a full-scale light aircraft manufacturer driving the transformation of Malaysia's aerospace landscape. Backed by proprietary Aircraft Manufacturing Technology (AMT) and an FAA-certified Type Certificate Part 23, AERONAS is positioned as a game changer and catalyst for the regional and global aviation industry.
                </p>
                <div class="hero-actions">
                    <a href="#video-section" class="primary-cta" id="getStartedBtn">Get started</a>
                </div>
                <p class="hero-caption">Trusted by operators and partners across the region.</p>
            </div>
        </section>

        <!-- Social Media Icons Section -->
        <section class="social-icons-section" id="socialIconsSection">
            <div class="social-icons-grid">
                <div class="social-icon-item">
                    <div class="icon-box icon-first-malaysia"></div>
                    <p>FIRST IN MALAYSIA</p>
                </div>
                <div class="social-icon-item">
                    <div class="icon-box icon-engineering"></div>
                    <p>ENGINEERING</p>
                </div>
                <div class="social-icon-item">
                    <div class="icon-box icon-certification-safety"></div>
                    <p>CERTIFICATION & SAFETY</p>
                </div>
                <div class="social-icon-item">
                    <div class="icon-box icon-manufacturing"></div>
                    <p>MANUFACTURING</p>
                </div>
                <div class="social-icon-item">
                    <div class="icon-box icon-performance"></div>
                    <p>PERFORMANCE</p>
                </div>
                <div class="social-icon-item">
                    <div class="icon-box icon-reliability"></div>
                    <p>RELIABILITY</p>
                </div>
            </div>
            <div class="social-icons-text">
                <h2>Malaysia‚Äôs First Aircraft Manufacturer Starts Here</h2>
                <p> Aeronas Aerocraft is Malaysia‚Äôs first small aircraft manufacturer, executing a focused strategy to build a globally competitive aerospace company engineered to international certification, performance, and safety standards. We operate with industrial discipline across advanced aeronautical engineering, R&D, and manufacturing, moving fast, making data-driven decisions, and challenging legacy aerospace models. Our objective is clear: deliver efficient, reliable, and commercially scalable aircraft while establishing national aerospace capability that competes on a global level.
        </section>

        <!-- Design Mockups Grid (News Section) -->
        <section class="mockups-section">
            <div class="news-video-container" id="video-section">
                <div class="video-top-line" id="videoTopLine"></div>
                <video id="newsVideo" autoplay loop playsinline muted class="news-video" controlsList="nodownload nofullscreen noremoteplayback" disablePictureInPicture preload="auto">
                    <source src="assets/images/Media1.mp4" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
                <div class="video-dark-overlay" id="videoDarkOverlay"></div>
                <div class="video-controls">
                    <button type="button" class="video-control-btn" id="playPauseBtn" aria-label="Play/Pause">
                        <span class="play-icon">‚ñ∂Ô∏è</span>
                        <span class="pause-icon" style="display: none;">‚è∏Ô∏è</span>
                    </button>
                    <button type="button" class="video-control-btn" id="soundBtn" aria-label="Toggle sound">
                        <span class="mute-icon">üîá</span>
                        <span class="unmute-icon" style="display: none;">üîä</span>
                    </button>
                </div>
            </div>
            <div class="mockups-grid" id="newsCardsGrid">
                <!-- News cards will be dynamically loaded here -->
            </div>
        </section>

        <!-- App Banner -->
        <section class="app-banner">
            <div class="app-banner-text">
                <div class="app-kicker">Next Generation</div>
                <h2>Aeronas Aerocraft Platform</h2>
                <p>Experience the future of aerospace technology with our comprehensive platform.</p>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="footer-contact">
            <div class="footer-col">
                <h4>TEL</h4>
                <p>07-4450444</p>
            </div>
            <div class="footer-col">
                <h4>E-MAIL</h4>
                <p>admin@aeronasgrp.com</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>¬© 2025 Aeronas Aerocraft. All rights reserved.</p>
        </div>
    </footer>

    <script type="module">
        // Import Firebase functions
        import { loadNewsFromFirestore } from './assets/js/news-firebase.js';
        import { newsData } from './assets/js/news-data.js';
        
        // News card templates
        const cardTemplates = [
            {
                type: 'latest-news',
                html: (news) => `
                    <a href="news.html?news=${news.id}" class="mockup-card card-latest-news" data-news-id="${news.id}">
                        <div class="mockup-sidebar red-sidebar">
                            <p class="sidebar-text vertical">AERONAS.COM</p>
                            <p class="sidebar-text-bottom">NEWS</p>
                        </div>
                        <div class="mockup-content">
                            <div class="mockup-overlay">
                                <h3>LATEST NEWS</h3>
                                <div class="mockup-brand">
                                    <span class="brand-aeronas">AERONAS</span>
                                    <span class="brand-aerocraft">AEROCRAFT</span>
                                </div>
                            </div>
                        </div>
                    </a>
                `
            },
            {
                type: 'news-updates',
                html: (news) => `
                    <a href="news.html?news=${news.id}" class="mockup-card card-news-updates" data-news-id="${news.id}">
                        <div class="mockup-overlay-full">
                            <h3>NEWS<br>UPDATES<br>EVENTS</h3>
                            <div class="mockup-brand">
                                <span class="brand-aeronas">AERONAS</span>
                                <span class="brand-aerocraft">AEROCRAFT</span>
                            </div>
                        </div>
                    </a>
                `
            },
            {
                type: 'industry-news',
                html: (news) => `
                    <a href="news.html?news=${news.id}" class="mockup-card card-industry-news" data-news-id="${news.id}">
                        <div class="mockup-sidebar blue-sidebar">
                            <p class="sidebar-text vertical">AERONAS.COM</p>
                            <p class="sidebar-text-bottom">NEWS</p>
                        </div>
                        <div class="mockup-content">
                            <div class="mockup-overlay">
                                <h3>INDUSTRY<br>NEWS</h3>
                                <div class="mockup-brand">
                                    <span class="brand-aeronas">AERONAS</span>
                                    <span class="brand-aerocraft">AEROCRAFT</span>
                                </div>
                            </div>
                        </div>
                    </a>
                `
            },
            {
                type: 'aerospace-news',
                html: (news) => `
                    <a href="news.html?news=${news.id}" class="mockup-card card-aerospace-news" data-news-id="${news.id}">
                        <div class="mockup-overlay-full">
                            <h3>AEROSPACE NEWS</h3>
                            <div class="mockup-brand">
                                <span class="brand-aerocraft">AEROCRAFT</span>
                            </div>
                        </div>
                    </a>
                `
            },
            {
                type: 'news-ac',
                html: (news) => `
                    <a href="news.html?news=${news.id}" class="mockup-card card-news-ac" data-news-id="${news.id}">
                        <div class="mockup-overlay-split">
                            <span class="text-left">NEWS</span>
                            <span class="text-right">UPDATES</span>
                            <span class="text-ac">AC</span>
                        </div>
                    </a>
                `
            },
            {
                type: 'latest-split',
                html: (news) => `
                    <a href="news.html?news=${news.id}" class="mockup-card card-latest-split" data-news-id="${news.id}">
                        <div class="mockup-split-top"></div>
                        <div class="mockup-split-bottom">
                            <div class="split-left-red">
                                <h3>LATEST NEWS.<br>STAY UPDATED.</h3>
                                <p>AERONAS.COM</p>
                            </div>
                            <div class="split-right-blue">
                                <h3>NEWS</h3>
                            </div>
                        </div>
                    </a>
                `
            }
        ];
        
        // Function to render news cards with images
        function renderNewsCards(newsArray) {
            const grid = document.getElementById('newsCardsGrid');
            if (!grid) return;
            
            // Sort by date (newest first)
            const sortedNews = [...newsArray].sort((a, b) => {
                return new Date(b.dateSort) - new Date(a.dateSort);
            });
            
            // Clear grid
            grid.innerHTML = '';
            
            // Render cards (max 6 cards)
            const newsToShow = sortedNews.slice(0, 6);
            
            // Create style element for dynamic background images
            let styleElement = document.getElementById('dynamic-news-images');
            if (!styleElement) {
                styleElement = document.createElement('style');
                styleElement.id = 'dynamic-news-images';
                document.head.appendChild(styleElement);
            }
            
            let styleContent = '';
            
            newsToShow.forEach((news, index) => {
                // Fix image path - convert absolute Windows path to relative path
                let imagePath = news.image || news.imageUrl || '';
                
                // Map filename to correct image file (always use lowercase extension)
                const imageMap = {
                    'UTeM-Aeronas.jpeg': 'UTEM.jpeg',
                    'UTeM-Aeronas.Jpeg': 'UTEM.jpeg',
                    'UTeM-Aeronas.JPEG': 'UTEM.jpeg',
                    'UTeM-Aeronas': 'UTEM.jpeg',
                    'UTEM.jpeg': 'UTEM.jpeg',
                    'UTEM.Jpeg': 'UTEM.jpeg',
                    'UTEM.JPEG': 'UTEM.jpeg',
                    'KKTM.jpeg': 'KKTM.jpeg',
                    'KKTM.Jpeg': 'KKTM.jpeg',
                    'USIM.jpeg': 'USIM.jpeg',
                    'USIM.Jpeg': 'USIM.jpeg',
                    'UTHM.jpeg': 'UTHM.jpeg',
                    'UTHM.Jpeg': 'UTHM.jpeg',
                    'GMI.jpeg': 'GMI.jpeg',
                    'GMI.Jpeg': 'GMI.jpeg',
                    'CHEMTRON.jpeg': 'CHEMTRON.jpeg',
                    'CHEMTRON.Jpeg': 'CHEMTRON.jpeg'
                };
                
                // Extract filename from path (handle both absolute and relative paths)
                let filename = '';
                if (imagePath.includes('C:\\') || imagePath.includes('C:/') || imagePath.includes('\\')) {
                    // Absolute Windows path
                    filename = imagePath.split(/[/\\]/).pop();
                } else if (imagePath.includes('/')) {
                    // Relative path with directory
                    filename = imagePath.split('/').pop();
                } else {
                    // Just filename
                    filename = imagePath;
                }
                
                // Normalize extension to lowercase for case-insensitive matching
                const filenameLower = filename.toLowerCase();
                const baseName = filename.split('.').slice(0, -1).join('.');
                const extension = filename.split('.').pop()?.toLowerCase() || '';
                const normalizedFilename = extension ? `${baseName}.${extension}` : filename;
                
                // Apply mapping to get correct filename (case-insensitive)
                let correctFilename = imageMap[filename] || imageMap[normalizedFilename] || imageMap[filenameLower];
                if (!correctFilename) {
                    // If no mapping found, use normalized filename (lowercase extension)
                    correctFilename = normalizedFilename;
                }
                
                // Rebuild path with correct filename
                if (imagePath.includes('C:\\') || imagePath.includes('C:/') || imagePath.includes('\\')) {
                    // Absolute path - convert to relative
                    imagePath = `assets/images/${correctFilename}`;
                    if (filename !== correctFilename) {
                        console.log(`Index - News ${news.id}: Converted "${filename}" to "${correctFilename}"`);
                    }
                } else if (imagePath.includes('/')) {
                    // Relative path - replace filename
                    imagePath = imagePath.replace(filename, correctFilename);
                    if (filename !== correctFilename) {
                        console.log(`Index - News ${news.id}: Fixed "${filename}" to "${correctFilename}"`);
                    }
                } else {
                    // Just filename - add path prefix
                    imagePath = `assets/images/${correctFilename}`;
                    if (filename !== correctFilename) {
                        console.log(`Index - News ${news.id}: Fixed "${filename}" to "${correctFilename}"`);
                    }
                }
                
                // Final replacement for any remaining UTeM-Aeronas references (safety check)
                if (imagePath && imagePath.includes('UTeM-Aeronas')) {
                    imagePath = imagePath.replace(/UTeM-Aeronas\.jpeg?/g, 'UTEM.jpeg');
                    console.log(`Index - News ${news.id}: Final safety fix - replaced UTeM-Aeronas with UTEM`);
                }
                
                // Remove URL encoding and clean path
                imagePath = imagePath.replace(/%22/g, '').replace(/%20/g, ' ').replace(/['"]/g, '').trim();
                
                // Ensure path is relative (final check)
                if (imagePath && !imagePath.startsWith('assets/') && !imagePath.startsWith('/assets/') && !imagePath.startsWith('./assets/') && !imagePath.startsWith('http')) {
                    const finalFilename = imagePath.split(/[/\\]/).pop();
                    const finalCorrectFilename = imageMap[finalFilename] || finalFilename;
                    imagePath = `assets/images/${finalCorrectFilename}`;
                }
                
                // Final validation - ensure no encoding issues
                if (imagePath.includes('%')) {
                    imagePath = decodeURIComponent(imagePath);
                    console.log(`Index - News ${news.id}: Decoded URL encoding in path`);
                }
                
                // Final normalization - ensure extension is lowercase
                if (imagePath && imagePath.includes('.')) {
                    const pathParts = imagePath.split('.');
                    if (pathParts.length > 1) {
                        const ext = pathParts.pop();
                        imagePath = pathParts.join('.') + '.' + ext.toLowerCase();
                    }
                }
                
                const template = cardTemplates[index % cardTemplates.length];
                const cardHtml = template.html(news);
                grid.insertAdjacentHTML('beforeend', cardHtml);
                
                // Set background image for the card
                const card = grid.querySelector(`[data-news-id="${news.id}"]`);
                if (card) {
                    // Clean imagePath - remove any quotes, encoding, or special characters
                    let cleanImagePath = imagePath.replace(/['"]/g, '').trim();
                    // Remove URL encoding
                    cleanImagePath = cleanImagePath.replace(/%22/g, '').replace(/%20/g, ' ');
                    // Ensure it's a valid relative path
                    if (!cleanImagePath.startsWith('assets/')) {
                        cleanImagePath = `assets/images/${cleanImagePath.split(/[/\\]/).pop()}`;
                    }
                    
                    // Escape single quotes for CSS
                    const escapedPath = cleanImagePath.replace(/'/g, "\\'");
                    
                    // Set background image based on card type
                    if (template.type === 'latest-news' || template.type === 'industry-news') {
                        // For cards with ::after pseudo-element
                        styleContent += `
                            .card-latest-news[data-news-id="${news.id}"]::after,
                            .card-industry-news[data-news-id="${news.id}"]::after {
                                background-image: url('${escapedPath}') !important;
                            }
                        `;
                    } else {
                        // Direct background image for other cards
                        styleContent += `
                            .card-news-updates[data-news-id="${news.id}"],
                            .card-aerospace-news[data-news-id="${news.id}"],
                            .card-news-ac[data-news-id="${news.id}"],
                            .card-latest-split[data-news-id="${news.id}"] {
                                background-image: url('${escapedPath}') !important;
                                background-size: cover !important;
                                background-position: center !important;
                            }
                        `;
                    }
                    
                    // Debug log
                    console.log(`Index - News ${news.id}: Final image path: ${cleanImagePath}`);
                }
            });
            
            // Apply all styles at once
            styleElement.textContent = styleContent;
        }
        
        // Load news from Firestore or use local data
        async function loadNews() {
            try {
                const news = await loadNewsFromFirestore();
                if (news && news.length > 0) {
                    renderNewsCards(news);
                } else {
                    // Fallback to local data
                    renderNewsCards(newsData);
                }
            } catch (error) {
                console.error('Error loading news:', error);
                // Fallback to local data
                renderNewsCards(newsData);
            }
        }
        
        // Initialize news cards
        loadNews();
    </script>
    
    <script>
        // Scroll effect: background gets darker as you scroll down
        const scrollDarkOverlay = document.getElementById('scrollDarkOverlay');
        
        window.addEventListener('scroll', () => {
            const scrollPosition = window.pageYOffset;
            const windowHeight = window.innerHeight;
            const documentHeight = document.documentElement.scrollHeight;
            const scrollPercentage = scrollPosition / (documentHeight - windowHeight);
            
            // Calculate opacity: 0 at top, up to 0.6 at bottom
            const opacity = Math.min(scrollPercentage * 0.6, 0.6);
            scrollDarkOverlay.style.opacity = opacity;
        }, { passive: true });

        // Smooth scroll to video section and popup effect
        const getStartedBtn = document.getElementById('getStartedBtn');
        const videoSection = document.getElementById('video-section');
        
        if (getStartedBtn && videoSection) {
            getStartedBtn.addEventListener('click', (e) => {
                e.preventDefault();
                
                // Smooth scroll to video section
                videoSection.scrollIntoView({ 
                    behavior: 'smooth',
                    block: 'start'
                });
                
                // Add popup effect after scroll
                setTimeout(() => {
                    videoSection.classList.add('video-popup');
                    setTimeout(() => {
                        videoSection.classList.remove('video-popup');
                    }, 1000);
                }, 500);
            });
        }

        // Video controls - Play/Pause and Sound
        const newsVideo = document.getElementById('newsVideo');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const soundBtn = document.getElementById('soundBtn');
        
        if (!playPauseBtn || !soundBtn) {
            console.error('Video control buttons not found!');
        }
        
        const playIcon = playPauseBtn?.querySelector('.play-icon');
        const pauseIcon = playPauseBtn?.querySelector('.pause-icon');
        const muteIcon = soundBtn?.querySelector('.mute-icon');
        const unmuteIcon = soundBtn?.querySelector('.unmute-icon');

        // Update play/pause icon based on video state
        function updatePlayPauseIcon() {
            if (newsVideo && playIcon && pauseIcon) {
                if (newsVideo.paused) {
                    playIcon.style.display = 'inline';
                    pauseIcon.style.display = 'none';
                } else {
                    playIcon.style.display = 'none';
                    pauseIcon.style.display = 'inline';
                }
            }
        }

        // Update sound icon based on mute state
        function updateSoundIcon() {
            if (newsVideo && muteIcon && unmuteIcon) {
                if (newsVideo.muted) {
                    muteIcon.style.display = 'inline';
                    unmuteIcon.style.display = 'none';
                } else {
                    muteIcon.style.display = 'none';
                    unmuteIcon.style.display = 'inline';
                }
            }
        }

        // Play/Pause button handler
        if (playPauseBtn && newsVideo) {
            playPauseBtn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                if (newsVideo.paused) {
                    newsVideo.play();
                } else {
                    newsVideo.pause();
                }
                updatePlayPauseIcon();
            });
        }

        // Sound button handler - hanya toggle mute/unmute, tidak pause video
        if (soundBtn && newsVideo) {
            // Flag to track if sound button was clicked
            let soundButtonClicked = false;
            
            soundBtn.addEventListener('mousedown', function(e) {
                soundButtonClicked = true;
            }, true);
            
            soundBtn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                e.stopImmediatePropagation();
                
                soundButtonClicked = true;
                
                // Toggle mute/unmute sahaja - tidak pause/play video
                if (newsVideo.muted) {
                    // Unmute: set muted to false and ensure volume is max
                    newsVideo.muted = false;
                    newsVideo.volume = 1.0;
                } else {
                    // Mute: set muted to true
                    newsVideo.muted = true;
                }
                
                // Update icon immediately
                updateSoundIcon();
                
                // Reset flag after a short delay
                setTimeout(() => {
                    soundButtonClicked = false;
                }, 100);
                
                return false;
            }, true); // Use capture phase to ensure it fires first
            
            // Prevent video from pausing when sound button is clicked
            if (newsVideo) {
                newsVideo.addEventListener('click', function(e) {
                    if (soundButtonClicked) {
                        e.preventDefault();
                        e.stopPropagation();
                        e.stopImmediatePropagation();
                        return false;
                    }
                }, true);
            }
        }

        // Listen to video events to update icons
        if (newsVideo) {
            newsVideo.addEventListener('play', updatePlayPauseIcon);
            newsVideo.addEventListener('pause', updatePlayPauseIcon);
            newsVideo.addEventListener('volumechange', updateSoundIcon);
            newsVideo.addEventListener('loadedmetadata', function() {
                // Ensure volume is set when video loads
                newsVideo.volume = 1.0;
                updateSoundIcon();
            });
            newsVideo.addEventListener('canplay', function() {
                // Ensure volume is set when video can play
                newsVideo.volume = 1.0;
                updateSoundIcon();
            });
            
            // Initialize video - set volume to max, start muted for autoplay policy
            newsVideo.volume = 1.0;
            newsVideo.muted = true;
            
            // Initialize icons
            updatePlayPauseIcon();
            updateSoundIcon();
        }

    </script>

    <script>
        // Mobile menu toggle
        const mobileMenuToggle = document.getElementById('mobileMenuToggle');
        const headerNav = document.getElementById('headerNav');
        const headerRight = document.querySelector('.header-right');

        if (mobileMenuToggle && headerNav) {
            mobileMenuToggle.addEventListener('click', function(e) {
                e.stopPropagation();
                mobileMenuToggle.classList.toggle('active');
                headerNav.classList.toggle('mobile-open');
                if (headerRight) {
                    headerRight.classList.toggle('mobile-open');
                }
                document.body.classList.toggle('menu-open');
            }, { passive: false });

            // Toggle dropdown untuk Aircraft di mobile
            const navDropdown = headerNav.querySelector('.nav-dropdown');
            if (navDropdown) {
                const dropdownLink = navDropdown.querySelector(':scope > a');
                if (dropdownLink) {
                    dropdownLink.addEventListener('click', function(e) {
                        // Jangan navigate jika ada dropdown menu
                        if (navDropdown.querySelector('.dropdown-menu')) {
                            e.preventDefault();
                            e.stopPropagation();
                            navDropdown.classList.toggle('active');
                        }
                    });
                }
            }

            // Close menu when clicking on any navigation link (kecuali dropdown parent)
            const navLinks = headerNav.querySelectorAll('a');
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    // Skip jika ini adalah dropdown parent link
                    const parentDropdown = link.closest('.nav-dropdown');
                    if (parentDropdown) {
                        const parentLink = parentDropdown.querySelector(':scope > a');
                        if (link === parentLink) {
                            // Ini adalah dropdown parent - biarkan dropdown toggle handle
                            return;
                        }
                    }
                    
                    // Pastikan navigation proceed - jangan prevent default atau stop propagation
                    // Close menu immediately untuk allow navigation
                    mobileMenuToggle.classList.remove('active');
                    headerNav.classList.remove('mobile-open');
                    if (headerRight) {
                        headerRight.classList.remove('mobile-open');
                    }
                    document.body.classList.remove('menu-open');
                    
                    // Navigation akan proceed secara normal - tidak ada preventDefault() atau stopPropagation()
                    // Link akan navigate ke href secara normal
                });
            });

            // Close menu when clicking outside (tapi jangan block navigation links)
            document.addEventListener('click', function(event) {
                // Skip jika click pada navigation link - biarkan navigation proceed
                if (event.target.closest('.header-nav a')) {
                    return;
                }
                
                if (!headerNav.contains(event.target) && !mobileMenuToggle.contains(event.target)) {
                    mobileMenuToggle.classList.remove('active');
                    headerNav.classList.remove('mobile-open');
                    if (headerRight) {
                        headerRight.classList.remove('mobile-open');
                    }
                    document.body.classList.remove('menu-open');
                }
            });
        }
    </script>
</body>
</html>
