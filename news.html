<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News â€“ Aeronas Aerocraft</title>
    <link rel="icon" type="image/png" href="assets/images/Logo-Icon-Only.png">
    <link rel="shortcut icon" type="image/png" href="assets/images/Logo-Icon-Only.png">
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body class="theme-dark">
    <!-- Header (Otto-style navigation) -->
    <header class="site-header">
        <div class="header-left">
            <a href="index.html" class="brand-mark">
                <img src="assets/images/Logo-Icon-Only.png" alt="Logo" class="logo" />
                <span class="brand-text">Aeronas Aerocraft</span>
            </a>
        </div>

        <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Toggle menu">
            <span></span>
            <span></span>
            <span></span>
        </button>

        <nav class="header-nav" id="headerNav">
            <div class="mobile-nav-logo">
                <a href="index.html" class="brand-mark">
                    <img src="assets/images/Logo-Icon-Only.png" alt="Logo" class="logo">
                    <span class="brand-text">Aeronas Aerocraft</span>
                </a>
            </div>
            <a href="index.html">Home</a>
            <a href="aircraft.html" class="nav-mobile-aircraft">Aircraft</a>
            <div class="nav-dropdown">
            <a href="aircraft.html">Aircraft</a>
                <div class="dropdown-menu">
                    <a href="aircraft.html#manufacturing">Manufacturing</a>
                    <a href="technology.html">Technology</a>
                    <a href="compliance.html">Compliance</a>
                </div>
            </div>
            <a href="about.html">About</a>
            <a href="services.html">Careers</a>
            <a href="news.html" class="active">News</a>
            <!-- <a href="event.html">Event</a> -->
            <a href="contact.html" class="nav-mobile-contact">Contact Us</a>
        </nav>

        <div class="header-right">
            <a href="contact.html" class="nav-cta">Contact Us</a>
        </div>
    </header>

    <!-- Main Content -->
    <main class="news-page-main" id="newsPageMain">
        <!-- Desktop Split Container -->
        <div class="news-split-container">
            <!-- Left Panel: Background Image with Content -->
            <div class="news-left-panel" id="newsLeftPanel">
                <div class="news-background-image" id="newsBackgroundImage"></div>
                <div class="news-left-content">
                    <p class="news-location-label" id="newsLocationLabel">AERONAS AEROCRAFT</p>
                    <h1 class="news-main-title" id="newsMainTitle">Latest News</h1>
                    <p class="news-main-description" id="newsMainDescription">Stay updated with our latest developments, achievements, and industry insights.</p>
                    <button class="news-explore-btn" id="newsExploreBtn">
                        Explore <span class="arrow-icon">â†’</span>
                    </button>
                </div>
            </div>

            <!-- Right Panel: News Cards List -->
            <div class="news-right-panel">
                <h2 class="news-right-title">Hot News</h2>
                <div class="news-cards-list" id="newsCategoriesGrid">
                    <!-- News cards will be loaded dynamically from Firestore or local data -->
                    <div style="text-align: center; padding: 40px; color: rgba(255,255,255,0.5);">
                        Loading news...
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Mobile Hero Section -->
        <div class="news-mobile-hero" id="newsMobileHero">
            <div class="news-mobile-hero-bg" id="newsMobileHeroBg"></div>
            <div class="news-mobile-hero-content">
                <span class="news-trending-badge" id="newsTrendingBadge">TRENDING</span>
                <h1 class="news-mobile-hero-title" id="newsMobileHeroTitle">Latest News</h1>
                <div class="news-mobile-author-info">
                    <div class="news-author-avatar">
                        <img src="assets/images/Logo-Icon-Only.png" alt="Author" onerror="this.style.display='none';">
                    </div>
                    <div class="news-author-details">
                        <span class="news-author-name">Aeronas Aerocraft</span>
                        <span class="news-author-time" id="newsAuthorTime">Just now</span>
                    </div>
                    <div class="news-mobile-actions">
                        <button class="news-action-btn" aria-label="Bookmark">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
                            </svg>
                        </button>
                        <button class="news-action-btn" aria-label="Share">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path>
                                <polyline points="16 6 12 2 8 6"></polyline>
                                <line x1="12" y1="2" x2="12" y2="15"></line>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Mobile News List -->
        <div class="news-mobile-list" id="newsMobileList">
            <div class="news-mobile-cards" id="newsMobileCards">
                <!-- News cards will be loaded dynamically -->
                <div style="text-align: center; padding: 40px; color: rgba(0,0,0,0.5);">
                    Loading news...
                </div>
            </div>
        </div>
        
        <!-- Fullscreen News View -->
        <div class="news-fullscreen-view" id="newsFullscreenView">
            <button class="news-close-btn" id="newsCloseBtn">Ã—</button>
            <div class="news-fullscreen-content">
                <div class="news-fullscreen-image" id="newsFullscreenImage"></div>
                <div class="news-fullscreen-text-wrapper">
                    <div class="news-fullscreen-text" id="newsFullscreenText"></div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="footer-content">
            <!-- Left Section: Branding & Social Media -->
            <div class="footer-col footer-brand">
                <div class="footer-logo">
                    <img src="assets/images/Logo-Icon-Only.png" alt="Logo" class="footer-logo-img">
                    <span class="footer-brand-text">Aeronas Aerocraft</span>
                </div>
                <p class="footer-description">Leading aerospace innovation and excellence in aircraft manufacturing, technology, and compliance solutions.</p>
                <div class="footer-social">
                    <a href="https://www.linkedin.com/in/aeronas-aerocraft-341b8939b" target="_blank" rel="noopener noreferrer" class="social-icon" aria-label="LinkedIn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/>
                        </svg>
                    </a>
                    <a href="https://www.instagram.com/aeronasaerocraft" target="_blank" rel="noopener noreferrer" class="social-icon" aria-label="Instagram">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                        </svg>
                    </a>
                    <a href="https://www.facebook.com/share/17ikZkTuhd/?mibextid=wwXIfr" target="_blank" rel="noopener noreferrer" class="social-icon" aria-label="Facebook">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                        </svg>
                    </a>
                </div>
            </div>

            <!-- Middle Section: Quick Links -->
            <div class="footer-col footer-links">
                <h4>Quick Links</h4>
                <ul class="footer-nav">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="about.html">About</a></li>
                    <li><a href="aircraft.html">Aircraft</a></li>
                    <li><a href="services.html">Careers</a></li>
                    <li><a href="news.html">News</a></li>
                    <li><a href="contact.html">Contact</a></li>
                </ul>
            </div>

            <!-- Right Section: Contact Info -->
            <div class="footer-col footer-contact-info">
                <h4>Get In Touch</h4>
                <ul class="footer-contact-list">
                    <li>
                        <div class="contact-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                            </svg>
                        </div>
                        <span>Malaysia</span>
                    </li>
                    <li>
                        <div class="contact-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/>
                            </svg>
                        </div>
                        <a href="tel:074450444">07-4450444</a>
                    </li>
                    <li>
                        <div class="contact-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                            </svg>
                        </div>
                        <a href="mailto:admin@aeronasgrp.com">admin@aeronasgrp.com</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>Â© 2025 Aeronas Aerocraft. All rights reserved.</p>
        </div>
    </footer>

    <script type="module">
        // Import Firebase functions
        import { loadNewsFromFirestore } from './assets/js/news-firebase.js';
        import { newsData } from './assets/js/news-data.js';
        
        // Dynamic background image change on hover
        const newsBackgroundImage = document.getElementById('newsBackgroundImage');
        const newsCategoriesGrid = document.getElementById('newsCategoriesGrid');
        const newsMainTitle = document.getElementById('newsMainTitle');
        const newsMainDescription = document.getElementById('newsMainDescription');
        const newsLocationLabel = document.getElementById('newsLocationLabel');
        
        // Store news data for auto-rotation
        let allNewsData = [];
        let heroRotationInterval = null;
        
        // Function to update hero section with random news
        function updateHeroWithRandomNews(newsArray) {
            if (!newsArray || newsArray.length === 0) return;
            
            const isMobile = window.innerWidth <= 768;
            const randomIndex = Math.floor(Math.random() * newsArray.length);
            const randomNews = newsArray[randomIndex];
            
            if (isMobile) {
                // Update mobile hero
                renderMobileHero(randomNews);
            } else {
                // Update desktop hero
                const randomImage = cleanImagePath(randomNews.image || randomNews.imageUrl || '');
                if (randomImage) {
                    updateBackground(randomImage);
                }
                if (newsMainTitle) {
                    newsMainTitle.style.transition = 'opacity 0.5s ease';
                    newsMainTitle.style.opacity = '0';
                    setTimeout(() => {
                        newsMainTitle.textContent = randomNews.title || 'Latest News';
                        newsMainTitle.style.opacity = '1';
                    }, 250);
                }
                if (newsMainDescription) {
                    newsMainDescription.style.transition = 'opacity 0.5s ease';
                    newsMainDescription.style.opacity = '0';
                    setTimeout(() => {
                        const desc = randomNews.description || randomNews.content || 'Stay updated with our latest developments, achievements, and industry insights.';
                        newsMainDescription.textContent = desc.length > 150 ? desc.substring(0, 150) + '...' : desc;
                        newsMainDescription.style.opacity = '1';
                    }, 250);
                }
            }
        }
        
        // Start auto-rotation for hero section
        function startHeroRotation(newsArray) {
            // Clear existing interval
            if (heroRotationInterval) {
                clearInterval(heroRotationInterval);
            }
            
            // Rotate hero every 5 seconds
            heroRotationInterval = setInterval(() => {
                if (allNewsData && allNewsData.length > 0) {
                    updateHeroWithRandomNews(allNewsData);
                }
            }, 5000); // 5 seconds
        }
        
        // Stop hero rotation
        function stopHeroRotation() {
            if (heroRotationInterval) {
                clearInterval(heroRotationInterval);
                heroRotationInterval = null;
            }
        }
        
        // Function to update background image
        function updateBackground(imagePath) {
            const newsBackgroundImage = document.getElementById('newsBackgroundImage');
            if (newsBackgroundImage && imagePath) {
                // Clean image path - ensure it uses cleanImagePath if available, otherwise clean it here
                let cleanPath = imagePath.trim();
                
                // Remove file:// protocol if present
                if (cleanPath.includes('file://')) {
                    cleanPath = cleanPath.replace(/^file:\/\/\/?/, '');
                    const filename = cleanPath.split(/[/\\]/).pop();
                    const cleanFilename = filename.split('?')[0].split('#')[0];
                    cleanPath = `assets/images/${cleanFilename}`;
                }
                
                // Remove absolute Windows paths
                if (cleanPath.includes('C:\\') || cleanPath.includes('C:/') || cleanPath.includes('\\')) {
                    const filename = cleanPath.split(/[/\\]/).pop();
                    const cleanFilename = filename.split('?')[0].split('#')[0];
                    cleanPath = `assets/images/${cleanFilename}`;
                }
                
                // Remove quotes if present
                cleanPath = cleanPath.replace(/['"]/g, '');
                // Remove URL encoding
                cleanPath = cleanPath.replace(/%22/g, '').replace(/%20/g, ' ');
                
                // Ensure path is relative - handle plain filenames like "tengku.jpeg"
                if (cleanPath && !cleanPath.startsWith('assets/') && !cleanPath.startsWith('/assets/') && !cleanPath.startsWith('./assets/') && !cleanPath.startsWith('http') && !cleanPath.startsWith('file://')) {
                    if (!cleanPath.includes('/')) {
                        // Plain filename like "tengku.jpeg" - add assets/images/ prefix
                        cleanPath = `assets/images/${cleanPath}`;
                    } else {
                        const filename = cleanPath.split(/[/\\]/).pop();
                        const cleanFilename = filename.split('?')[0].split('#')[0];
                        cleanPath = `assets/images/${cleanFilename}`;
                    }
                }
                
                // Final cleanup - ensure no absolute paths
                if (cleanPath.includes('C:\\') || cleanPath.includes('C:/') || cleanPath.includes('\\') || cleanPath.includes('file://')) {
                    const filename = cleanPath.split(/[/\\]/).pop();
                    const cleanFilename = filename.split('?')[0].split('#')[0];
                    cleanPath = `assets/images/${cleanFilename}`;
                }
                
                if (cleanPath.includes('%')) {
                    try {
                        cleanPath = decodeURIComponent(cleanPath);
                    } catch (e) {
                        // Image path decode failed - silently handle
                    }
                }
                
                // Update background image directly
                newsBackgroundImage.style.backgroundImage = `url('${cleanPath.replace(/'/g, "\\'")}')`;
                // Background updated successfully
            }
        }
        
        // Auto-slide functionality for desktop
        let autoSlideInterval = null;
        let newsImages = [];
        let isPaused = false;
        let currentRandomImage = null;
        
        // Helper function to clean image path (same as renderNewsCards)
        function cleanImagePath(imagePath) {
            if (!imagePath) return '';
            
            let cleanPath = imagePath.trim();
            
            // Remove file:// protocol if present
            if (cleanPath.includes('file://')) {
                cleanPath = cleanPath.replace(/^file:\/\/\/?/, '');
            }
            
            // Remove absolute Windows paths (C:\ or C:/)
            if (cleanPath.includes('C:\\') || cleanPath.includes('C:/') || (cleanPath.includes('\\') && !cleanPath.startsWith('http'))) {
                const filename = cleanPath.split(/[/\\]/).pop();
                const cleanFilename = filename.split('?')[0].split('#')[0];
                cleanPath = `assets/images/${cleanFilename}`;
            }
            
            // Remove quotes if present
            cleanPath = cleanPath.replace(/['"]/g, '');
            
            // If path already starts with assets/, keep it as is (just remove ./ if present)
            if (cleanPath.startsWith('assets/') || cleanPath.startsWith('./assets/')) {
                cleanPath = cleanPath.replace(/^\.\//, '');
                return cleanPath;
            }
            
            // If it's an HTTP/HTTPS URL, keep it as is
            if (cleanPath.startsWith('http://') || cleanPath.startsWith('https://') || cleanPath.startsWith('//')) {
                return cleanPath;
            }
            
            // If it's a plain filename (no slashes), add assets/images/ prefix
            if (!cleanPath.includes('/') && !cleanPath.includes('\\')) {
                return `assets/images/${cleanPath.split('?')[0].split('#')[0]}`;
            }
            
            // If it has a path but doesn't start with assets/, extract filename
            const filename = cleanPath.split(/[/\\]/).pop();
            const cleanFilename = filename.split('?')[0].split('#')[0];
            return `assets/images/${cleanFilename}`;
        }
        
        function startAutoSlide(newsArray) {
            // Only run on desktop
            if (window.innerWidth <= 768) {
                return;
            }
            
            // Clear existing interval
            if (autoSlideInterval) {
                clearInterval(autoSlideInterval);
            }
            
            // Get all news images using same logic as renderNewsCards
            newsImages = newsArray
                .map(news => {
                    const imagePath = news.image || news.imageUrl || '';
                    return cleanImagePath(imagePath);
                })
                .filter(imagePath => imagePath && imagePath.startsWith('assets/'));
            
            // If no images, don't start auto-slide
            if (newsImages.length === 0) {
                return;
            }
            
            // Function to get random image (avoid same image consecutively)
            function getRandomImage() {
                if (newsImages.length === 1) {
                    return newsImages[0];
                }
                
                let randomImage;
                do {
                    const randomIndex = Math.floor(Math.random() * newsImages.length);
                    randomImage = newsImages[randomIndex];
                } while (randomImage === currentRandomImage && newsImages.length > 1);
                
                currentRandomImage = randomImage;
                return randomImage;
            }
            
            // Auto-slide every 5 seconds with random selection
            autoSlideInterval = setInterval(() => {
                if (!isPaused && window.innerWidth > 768) {
                    const randomImage = getRandomImage();
                    updateBackground(randomImage);
                }
            }, 5000); // 5 seconds per slide
        }
        
        function stopAutoSlide() {
            if (autoSlideInterval) {
                clearInterval(autoSlideInterval);
                autoSlideInterval = null;
            }
        }
        
        function pauseAutoSlide() {
            isPaused = true;
        }
        
        function resumeAutoSlide() {
            isPaused = false;
        }
        
        // Function to format time ago
        function formatTimeAgo(dateString) {
            if (!dateString) return 'Just now';
            
            try {
                const date = new Date(dateString);
                const now = new Date();
                const diffMs = now - date;
                const diffMins = Math.floor(diffMs / 60000);
                const diffHours = Math.floor(diffMs / 3600000);
                const diffDays = Math.floor(diffMs / 86400000);
                
                if (diffMins < 1) return 'Just now';
                if (diffMins < 60) return `${diffMins} ${diffMins === 1 ? 'minute' : 'minutes'} ago`;
                if (diffHours < 24) return `${diffHours} ${diffHours === 1 ? 'hour' : 'hours'} ago`;
                if (diffDays < 7) return `${diffDays} ${diffDays === 1 ? 'day' : 'days'} ago`;
                
                // Format as date if older
                return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: date.getFullYear() !== now.getFullYear() ? 'numeric' : undefined });
            } catch (e) {
                return dateString;
            }
        }
        
        // Function to render mobile hero
        function renderMobileHero(news) {
            const mobileHeroBg = document.getElementById('newsMobileHeroBg');
            const mobileHeroTitle = document.getElementById('newsMobileHeroTitle');
            const authorTime = document.getElementById('newsAuthorTime');
            
            if (!news) return;
            
            const imagePath = cleanImagePath(news.image || news.imageUrl || '');
            
            if (mobileHeroBg && imagePath) {
                mobileHeroBg.style.backgroundImage = `url('${imagePath.replace(/'/g, "\\'")}')`;
            }
            
            if (mobileHeroTitle) {
                mobileHeroTitle.textContent = news.title || 'Latest News';
            }
            
            if (authorTime) {
                authorTime.textContent = formatTimeAgo(news.dateSort || news.date || '');
            }
        }
        
        // Function to render news cards
        function renderNewsCards(newsArray) {
            const isMobile = window.innerWidth <= 768;
            const newsMobileCards = document.getElementById('newsMobileCards');
            
            if (!newsCategoriesGrid && !newsMobileCards) {
                console.error('News categories grid not found');
                return;
            }
            
            if (!newsArray || newsArray.length === 0) {
                if (newsCategoriesGrid) {
                    newsCategoriesGrid.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: rgba(255,255,255,0.5); grid-column: 1 / -1;">
                            <p>No news articles found.</p>
                            <p style="font-size: 14px; margin-top: 10px;">Please add news articles through the admin dashboard.</p>
                        </div>
                    `;
                }
                if (newsMobileCards) {
                    newsMobileCards.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: rgba(0,0,0,0.5);">
                            <p>No news articles found.</p>
                            <p style="font-size: 14px; margin-top: 10px;">Please add news articles through the admin dashboard.</p>
                        </div>
                    `;
                }
                return;
            }
            
            // Clear existing cards
            if (newsCategoriesGrid) newsCategoriesGrid.innerHTML = '';
            if (newsMobileCards) newsMobileCards.innerHTML = '';
            
            // Sort by date (newest first)
            const sortedNews = [...newsArray].sort((a, b) => {
                return new Date(b.dateSort) - new Date(a.dateSort);
            });
            
            // Render mobile hero with random news item
            if (isMobile && sortedNews.length > 0) {
                const randomIndex = Math.floor(Math.random() * sortedNews.length);
                renderMobileHero(sortedNews[randomIndex]);
            }
            
            // Render cards in new format
            sortedNews.forEach((news, index) => {
                const isActive = index === 0; // First card is active by default
                const card = document.createElement('div');
                // Get image path from Firestore
                let imagePath = news.image || news.imageUrl || '';
                
                // Clean image path to ensure it's correct
                if (imagePath) {
                    imagePath = imagePath.trim();
                    
                    // Remove file:// protocol if present
                    if (imagePath.includes('file://')) {
                        imagePath = imagePath.replace(/^file:\/\/\/?/, '');
                    }
                    
                    // Remove absolute Windows paths (C:\ or C:/)
                    if (imagePath.includes('C:\\') || imagePath.includes('C:/') || (imagePath.includes('\\') && !imagePath.startsWith('http'))) {
                        const filename = imagePath.split(/[/\\]/).pop();
                        const cleanFilename = filename.split('?')[0].split('#')[0];
                        imagePath = `assets/images/${cleanFilename}`;
                    }
                    
                    // Remove quotes if present
                    imagePath = imagePath.replace(/['"]/g, '');
                    
                    // If path already starts with assets/, keep it as is (just remove ./ if present)
                    if (imagePath.startsWith('assets/') || imagePath.startsWith('./assets/')) {
                        imagePath = imagePath.replace(/^\.\//, '');
                    } else if (imagePath.startsWith('http://') || imagePath.startsWith('https://') || imagePath.startsWith('//')) {
                        // Keep HTTP/HTTPS URLs as is
                        // Do nothing
                    } else if (!imagePath.includes('/') && !imagePath.includes('\\')) {
                        // Plain filename (no slashes) - add assets/images/ prefix
                        imagePath = `assets/images/${imagePath.split('?')[0].split('#')[0]}`;
                    } else {
                        // Has path but doesn't start with assets/ - extract filename
                        const filename = imagePath.split(/[/\\]/).pop();
                        const cleanFilename = filename.split('?')[0].split('#')[0];
                        imagePath = `assets/images/${cleanFilename}`;
                    }
                }
                
                // Debug log
                if (imagePath) {
                    console.log(`News ${news.id} (${news.title}): Image path = ${imagePath}`);
                } else {
                    console.warn(`News ${news.id} (${news.title}): No image path found!`);
                }
                
                card.className = `news-card-item ${isActive ? 'active' : ''}`;
                card.id = `news-${news.id}`;
                card.setAttribute('data-bg', imagePath);
                card.setAttribute('data-date', news.dateSort || news.date || '');
                card.setAttribute('data-title', news.title || 'Untitled');
                card.setAttribute('data-description', news.description || news.content || 'No description available');
                card.setAttribute('data-image', imagePath);
                
                // Format date for display
                const displayDate = news.date || 'No date';
                
                card.innerHTML = `
                    <div class="news-card-image">
                        <img src="${imagePath || 'assets/images/logo.png'}" alt="${news.title || 'News image'}" onerror="this.style.display='none'; this.parentElement.style.backgroundColor='#e0e0e0';">
                    </div>
                    <div class="news-card-content">
                        <h3 class="news-card-title">${news.title || 'Untitled'}</h3>
                        <p class="news-card-date">${displayDate}</p>
                        <a href="#" class="news-card-more">More info <span>â†’</span></a>
                    </div>
                    <div class="news-card-bookmark">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
                        </svg>
                    </div>
                `;
                
                // Removed console.log - images are loading correctly
                // Only log if there's an actual error (no image path)
                if (!imagePath) {
                    console.error(`News ${news.id}: No image path found!`);
                }
                
                // Append to appropriate container
                if (isMobile && newsMobileCards) {
                    // Create mobile card format
                    const mobileCard = document.createElement('div');
                    mobileCard.className = 'news-mobile-card';
                    mobileCard.id = `news-mobile-${news.id}`;
                    mobileCard.setAttribute('data-bg', imagePath);
                    mobileCard.setAttribute('data-date', news.dateSort || news.date || '');
                    mobileCard.setAttribute('data-title', news.title || 'Untitled');
                    mobileCard.setAttribute('data-description', news.description || news.content || 'No description available');
                    mobileCard.setAttribute('data-image', imagePath);
                    
                    // Format time ago
                    const timeAgo = formatTimeAgo(news.dateSort || news.date || '');
                    
                    mobileCard.innerHTML = `
                        <div class="news-mobile-card-image">
                            <img src="${imagePath || 'assets/images/logo.png'}" alt="${news.title || 'News image'}" onerror="this.style.display='none'; this.parentElement.style.backgroundColor='#e0e0e0';">
                        </div>
                        <div class="news-mobile-card-content">
                            <h3 class="news-mobile-card-title">${news.title || 'Untitled'}</h3>
                            <span class="news-mobile-card-time">${timeAgo}</span>
                            <div class="news-mobile-card-actions">
                                <button class="news-action-btn" aria-label="Bookmark">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
                                    </svg>
                                </button>
                                <button class="news-action-btn" aria-label="Share">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path>
                                        <polyline points="16 6 12 2 8 6"></polyline>
                                        <line x1="12" y1="2" x2="12" y2="15"></line>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    `;
                    newsMobileCards.appendChild(mobileCard);
                } else if (!isMobile && newsCategoriesGrid) {
                    newsCategoriesGrid.appendChild(card);
                }
            });
            
            // Set initial background and content from random news item (desktop)
            if (!isMobile && sortedNews.length > 0) {
                const randomIndex = Math.floor(Math.random() * sortedNews.length);
                const randomNews = sortedNews[randomIndex];
                if (randomNews.image) {
                    const randomImage = cleanImagePath(randomNews.image || randomNews.imageUrl || '');
                    if (randomImage) {
                        updateBackground(randomImage);
                    }
                }
                if (newsMainTitle) {
                    newsMainTitle.textContent = randomNews.title || 'Latest News';
                }
                if (newsMainDescription) {
                    newsMainDescription.textContent = randomNews.description || randomNews.content || 'Stay updated with our latest developments, achievements, and industry insights.';
                }
            }
            
            // Store news data and start auto-rotation
            allNewsData = sortedNews;
            startHeroRotation(sortedNews);
            
            // Setup event listeners for cards
            setupCardListeners(sortedNews);
            
            // Handle URL parameter
            const urlParams = new URLSearchParams(window.location.search);
            const newsId = urlParams.get('news');
            
            if (newsId) {
                setTimeout(() => {
                    const targetCard = document.getElementById(`news-${newsId}`);
                    if (targetCard) {
                        // Remove active from all cards
                        document.querySelectorAll('.news-category-card').forEach(c => c.classList.remove('active'));
                        // Add active to target card
                        targetCard.classList.add('active');
                        // Update background
                        const bgImage = targetCard.getAttribute('data-bg');
                        if (bgImage) {
                            updateBackground(bgImage);
                        }
                        // Scroll to card
                        targetCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }, 300);
            }
        }
        
        // Setup card event listeners
        function setupCardListeners(sortedNewsArray = []) {
            const isMobile = window.innerWidth <= 768;
            const categoryCards = isMobile ? document.querySelectorAll('.news-mobile-card') : document.querySelectorAll('.news-card-item');
            const newsFullscreenView = document.getElementById('newsFullscreenView');
            const newsCloseBtn = document.getElementById('newsCloseBtn');
            const newsFullscreenImage = document.getElementById('newsFullscreenImage');
            const newsFullscreenText = document.getElementById('newsFullscreenText');

            // Check if mobile device - use function to check on each interaction
            function isMobileDevice() {
                return window.innerWidth <= 768;
            }

        categoryCards.forEach(card => {
            if (!isMobile) {
                card.addEventListener('mouseenter', () => {
                    // Pause auto-slide on hover
                    pauseAutoSlide();
                    
                    const bgImage = card.getAttribute('data-bg');
                    const cardTitle = card.getAttribute('data-title') || '';
                    const cardDescription = card.getAttribute('data-description') || '';
                    
                    // Update background image
                    if (bgImage) {
                        updateBackground(bgImage);
                    }
                    
                    // Update left panel content
                    if (newsMainTitle && cardTitle) {
                        newsMainTitle.style.transition = 'opacity 0.3s ease';
                        newsMainTitle.style.opacity = '0';
                        setTimeout(() => {
                            newsMainTitle.textContent = cardTitle;
                            newsMainTitle.style.opacity = '1';
                        }, 150);
                    }
                    
                    if (newsMainDescription && cardDescription) {
                        newsMainDescription.style.transition = 'opacity 0.3s ease';
                        newsMainDescription.style.opacity = '0';
                        setTimeout(() => {
                            newsMainDescription.textContent = cardDescription.length > 150 ? cardDescription.substring(0, 150) + '...' : cardDescription;
                            newsMainDescription.style.opacity = '1';
                        }, 150);
                    }
                    
                    // Remove active class from all cards
                    categoryCards.forEach(c => c.classList.remove('active'));
                    // Add active class to hovered card
                    card.classList.add('active');
                });
            }
            
            if (!isMobile) {
                card.addEventListener('mouseleave', () => {
                    // Resume auto-slide when mouse leaves
                    resumeAutoSlide();
                    // Show a random image when resuming
                    if (newsImages.length > 0) {
                        const randomIndex = Math.floor(Math.random() * newsImages.length);
                        currentRandomImage = newsImages[randomIndex];
                        updateBackground(currentRandomImage);
                    }
                    
                    // Reset to default content (random news item or default)
                    if (sortedNewsArray && sortedNewsArray.length > 0) {
                        const randomIndex = Math.floor(Math.random() * sortedNewsArray.length);
                        const randomNews = sortedNewsArray[randomIndex];
                        if (newsMainTitle) {
                            newsMainTitle.style.transition = 'opacity 0.3s ease';
                            newsMainTitle.style.opacity = '0';
                            setTimeout(() => {
                                newsMainTitle.textContent = randomNews.title || 'Latest News';
                                newsMainTitle.style.opacity = '1';
                            }, 150);
                        }
                        if (newsMainDescription) {
                            newsMainDescription.style.transition = 'opacity 0.3s ease';
                            newsMainDescription.style.opacity = '0';
                            setTimeout(() => {
                                const desc = randomNews.description || randomNews.content || 'Stay updated with our latest developments, achievements, and industry insights.';
                                newsMainDescription.textContent = desc.length > 150 ? desc.substring(0, 150) + '...' : desc;
                                newsMainDescription.style.opacity = '1';
                            }, 150);
                        }
                        // Also update background image
                        if (randomNews.image) {
                            const randomImage = cleanImagePath(randomNews.image || randomNews.imageUrl || '');
                            if (randomImage) {
                                updateBackground(randomImage);
                            }
                        }
                    }
                });
            }

                // Prevent "More info" link navigation
                const moreInfoLink = card.querySelector('.news-card-more');
                if (moreInfoLink) {
                    moreInfoLink.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        card.click(); // Trigger card click
                    });
                }
                
                // Click handler untuk fullscreen view (desktop) atau update hero (mobile)
                card.addEventListener('click', () => {
                    if (isMobile) {
                        // Mobile: Update hero section
                        const bgImage = card.getAttribute('data-bg');
                        const cardTitle = card.getAttribute('data-title') || '';
                        const cardDate = card.getAttribute('data-date') || '';
                        
                        const mobileHeroBg = document.getElementById('newsMobileHeroBg');
                        const mobileHeroTitle = document.getElementById('newsMobileHeroTitle');
                        const authorTime = document.getElementById('newsAuthorTime');
                        
                        if (mobileHeroBg && bgImage) {
                            mobileHeroBg.style.backgroundImage = `url('${bgImage.replace(/'/g, "\\'")}')`;
                        }
                        
                        if (mobileHeroTitle) {
                            mobileHeroTitle.textContent = cardTitle;
                        }
                        
                        if (authorTime) {
                            authorTime.textContent = formatTimeAgo(cardDate);
                        }
                        
                        // Scroll to top to show hero
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                        return;
                    }
                    
                    // Desktop: Show fullscreen view
                    // Get news data from card attributes
                    const cardTitle = card.getAttribute('data-title') || '';
                    const cardDescription = card.getAttribute('data-description') || '';
                    let cardImage = card.getAttribute('data-image') || card.getAttribute('data-bg') || '';
                    const cardDateAttr = card.getAttribute('data-date') || '';
                    const cardDateElement = card.querySelector('.news-card-date');
                    const cardDate = cardDateElement ? cardDateElement.textContent.replace('ðŸ“…', '').trim() : cardDateAttr;
                    
                    // Clean cardImage path using cleanImagePath function
                    if (cardImage) {
                        cardImage = cleanImagePath(cardImage);
                    }
                    
                    // Debug: Check image path
                    console.log('News:', cardTitle);
                    console.log('Image path:', cardImage);
                    console.log('Has image:', !!cardImage);
                    
                    // Show fullscreen view dengan layout: image kiri, text kanan
                    if (cardImage) {
                        newsFullscreenImage.innerHTML = `<img src="${cardImage}" alt="${cardTitle}" onerror="console.error('Image failed to load:', '${cardImage}'); this.style.display='none'; this.parentElement.style.backgroundColor='#2a2a2a';">`;
                    } else {
                        // No image - show dark gray background
                        console.warn('No image path for news:', cardTitle);
                        newsFullscreenImage.innerHTML = '';
                        newsFullscreenImage.style.backgroundColor = '#2a2a2a';
                    }
                    newsFullscreenText.innerHTML = `
                        <h2 class="news-fullscreen-title">${cardTitle}</h2>
                        ${cardDate ? `<p class="news-fullscreen-date">${cardDate}</p>` : ''}
                        <div class="news-fullscreen-description">${cardDescription}</div>
                    `;
                    newsFullscreenView.classList.add('active');
                    
                    // Prevent scroll on body
                    document.body.style.overflow = 'hidden';
                });
            });

            // Close fullscreen view
            if (newsCloseBtn) {
                newsCloseBtn.addEventListener('click', () => {
                    newsFullscreenView.classList.remove('active');
                    document.body.style.overflow = '';
                    // Reset image container background
                    newsFullscreenImage.style.backgroundColor = '';
                });
            }

            // Close on escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && newsFullscreenView.classList.contains('active')) {
                    newsFullscreenView.classList.remove('active');
                    document.body.style.overflow = '';
                    // Reset image container background
                    newsFullscreenImage.style.backgroundColor = '';
                }
            });
            
        }
        
        // Load news from Firestore or use local data
        async function loadNews() {
            try {
                const news = await loadNewsFromFirestore();
                if (news && news.length > 0) {
                    renderNewsCards(news);
                } else {
                    // Fallback to local data
                    renderNewsCards(newsData);
                }
            } catch (error) {
                console.error('Error loading news:', error);
                // Fallback to local data
                renderNewsCards(newsData);
            }
        }
        
        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            stopHeroRotation();
        });
        
        // Handle window resize
        window.addEventListener('resize', () => {
            if (window.innerWidth > 768) {
                // Reload news to restart auto-slide if needed
                loadNews();
            } else {
                stopAutoSlide();
                // Reload news for mobile layout
                loadNews();
            }
        });
        
        // Initialize
        loadNews();
        
        // Explore button click handler
        const newsExploreBtn = document.getElementById('newsExploreBtn');
        if (newsExploreBtn) {
            newsExploreBtn.addEventListener('click', () => {
                // Scroll to news cards
                const newsRightPanel = document.querySelector('.news-right-panel');
                if (newsRightPanel) {
                    newsRightPanel.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        }
    </script>

    <script>
        // Mobile menu toggle
        const mobileMenuToggle = document.getElementById('mobileMenuToggle');
        const headerNav = document.getElementById('headerNav');
        const headerRight = document.querySelector('.header-right');

        if (mobileMenuToggle && headerNav) {
            mobileMenuToggle.addEventListener('click', function(e) {
                e.stopPropagation();
                mobileMenuToggle.classList.toggle('active');
                headerNav.classList.toggle('mobile-open');
                if (headerRight) {
                    headerRight.classList.toggle('mobile-open');
                }
                document.body.classList.toggle('menu-open');
            });

            // Close menu when clicking on any navigation link
            const navLinks = headerNav.querySelectorAll('a');
            navLinks.forEach(link => {
                link.addEventListener('click', function() {
                    mobileMenuToggle.classList.remove('active');
                    headerNav.classList.remove('mobile-open');
                    if (headerRight) {
                        headerRight.classList.remove('mobile-open');
                    }
                    document.body.classList.remove('menu-open');
                });
            });

            document.addEventListener('click', function(event) {
                if (!headerNav.contains(event.target) && !mobileMenuToggle.contains(event.target)) {
                    mobileMenuToggle.classList.remove('active');
                    headerNav.classList.remove('mobile-open');
                    if (headerRight) {
                        headerRight.classList.remove('mobile-open');
                    }
                    document.body.classList.remove('menu-open');
                }
            });
        }
    </script>
</body>
</html>


