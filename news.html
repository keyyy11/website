<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News – Aeronas Aerocraft</title>
    <link rel="icon" type="image/png" href="assets/images/Logo-Icon-Only.png">
    <link rel="shortcut icon" type="image/png" href="assets/images/Logo-Icon-Only.png">
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body class="theme-dark">
    <!-- Header (Otto-style navigation) -->
    <header class="site-header">
        <div class="header-left">
            <a href="index.html" class="brand-mark">
                <img src="assets/images/Logo-Icon-Only.png" alt="Logo" class="logo" />
                <span class="brand-text">Aeronas Aerocraft</span>
            </a>
        </div>

        <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Toggle menu">
            <span></span>
            <span></span>
            <span></span>
        </button>

        <nav class="header-nav" id="headerNav">
            <div class="mobile-nav-logo">
                <a href="index.html" class="brand-mark">
                    <img src="assets/images/Logo-Icon-Only.png" alt="Logo" class="logo">
                    <span class="brand-text">Aeronas Aerocraft</span>
                </a>
            </div>
            <a href="index.html">Home</a>
            <div class="nav-dropdown">
                <a href="aircraft.html">Aircraft</a>
                <div class="dropdown-menu">
                    <a href="aircraft.html#manufacturing">Manufacturing</a>
                    <a href="technology.html">Technology</a>
                    <a href="compliance.html">Compliance</a>
                </div>
            </div>
            <a href="about.html">About</a>
            <a href="services.html">Careers</a>
            <a href="news.html" class="active">News</a>
            <!-- <a href="event.html">Event</a> -->
            <a href="contact.html" class="nav-mobile-contact">Contact Us</a>
        </nav>

        <div class="header-right">
            <a href="contact.html" class="nav-cta">Contact Us</a>
        </div>
    </header>

    <!-- Main Content -->
    <main class="news-page-main" id="newsPageMain">
        <div class="news-background-wrapper" id="newsBackground">
            <section class="news-hero-section" id="newsHeroSection">
                <div class="news-hero-content">
                    <p class="news-hero-label">ALL FIELDS OF APPLICATION</p>
                    <h1 class="news-hero-title" id="newsHeroTitle">NEWS</h1>
                </div>
            </section>

            <section class="news-categories-section" id="newsCategoriesSection">
                <div class="news-categories-grid" id="newsCategoriesGrid">
                    <!-- News cards will be loaded dynamically from Firestore or local data -->
                    <div style="text-align: center; padding: 40px; color: rgba(255,255,255,0.5);">
                        Loading news...
                    </div>
                </div>
            </section>
            
            <!-- Fullscreen News View -->
            <div class="news-fullscreen-view" id="newsFullscreenView">
                <button class="news-close-btn" id="newsCloseBtn">×</button>
                <div class="news-fullscreen-content">
                    <div class="news-fullscreen-image" id="newsFullscreenImage"></div>
                    <div class="news-fullscreen-text-wrapper">
                        <div class="news-fullscreen-text" id="newsFullscreenText"></div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="footer-contact">
            <div class="footer-col">
                <h4>TEL</h4>
                <p>07-4450444</p>
            </div>
            <div class="footer-col">
                <h4>E-MAIL</h4>
                <p>admin@aeronasgrp.com</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>© 2025 Aeronas Aerocraft. All rights reserved.</p>
        </div>
    </footer>

    <script type="module">
        // Import Firebase functions
        import { loadNewsFromFirestore } from './assets/js/news-firebase.js';
        import { newsData } from './assets/js/news-data.js';
        
        // Dynamic background image change on hover
        const newsBackground = document.getElementById('newsBackground');
        const newsCategoriesGrid = document.querySelector('.news-categories-grid');
        
        // Function to update background image
        function updateBackground(imagePath) {
            if (newsBackground && imagePath) {
                // Clean image path
                let cleanPath = imagePath.trim();
                
                // Remove file:// protocol if present
                if (cleanPath.includes('file://')) {
                    cleanPath = cleanPath.replace(/^file:\/\/\/?/, '');
                    // Extract just the filename
                    const filename = cleanPath.split(/[/\\]/).pop();
                    const cleanFilename = filename.split('?')[0].split('#')[0];
                    cleanPath = `assets/images/${cleanFilename}`;
                }
                
                // Remove absolute Windows paths
                if (cleanPath.includes('C:\\') || cleanPath.includes('C:/') || cleanPath.includes('\\')) {
                    const filename = cleanPath.split(/[/\\]/).pop();
                    const cleanFilename = filename.split('?')[0].split('#')[0];
                    cleanPath = `assets/images/${cleanFilename}`;
                }
                
                // Remove quotes if present
                cleanPath = cleanPath.replace(/['"]/g, '');
                // Remove URL encoding
                cleanPath = cleanPath.replace(/%22/g, '').replace(/%20/g, ' ');
                
                // Ensure path is relative
                if (cleanPath && !cleanPath.startsWith('assets/') && !cleanPath.startsWith('/assets/') && !cleanPath.startsWith('./assets/') && !cleanPath.startsWith('http') && !cleanPath.startsWith('file://')) {
                    if (!cleanPath.includes('/')) {
                        cleanPath = `assets/images/${cleanPath}`;
                    } else {
                        const filename = cleanPath.split(/[/\\]/).pop();
                        const cleanFilename = filename.split('?')[0].split('#')[0];
                        cleanPath = `assets/images/${cleanFilename}`;
                    }
                }
                
                // Final cleanup - ensure no absolute paths
                if (cleanPath.includes('C:\\') || cleanPath.includes('C:/') || cleanPath.includes('\\') || cleanPath.includes('file://')) {
                    const filename = cleanPath.split(/[/\\]/).pop();
                    const cleanFilename = filename.split('?')[0].split('#')[0];
                    cleanPath = `assets/images/${cleanFilename}`;
                }
                
                if (cleanPath.includes('%')) {
                    try {
                        cleanPath = decodeURIComponent(cleanPath);
                    } catch (e) {
                        // Image path decode failed - silently handle
                    }
                }
                
                // Create or update style element for background
                let style = document.getElementById('news-bg-dynamic');
                if (!style) {
                    style = document.createElement('style');
                    style.id = 'news-bg-dynamic';
                    document.head.appendChild(style);
                }
                // Escape single quotes in path
                const escapedPath = cleanPath.replace(/'/g, "\\'");
                style.textContent = `.news-background-wrapper::after { background-image: url('${escapedPath}') !important; background-size: cover !important; background-position: center !important; transition: background-image 0.5s ease !important; }`;
                // Background updated successfully
            }
        }
        
        // Function to render news cards
        function renderNewsCards(newsArray) {
            if (!newsCategoriesGrid) {
                console.error('News categories grid not found');
                return;
            }
            
            if (!newsArray || newsArray.length === 0) {
                newsCategoriesGrid.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: rgba(255,255,255,0.5); grid-column: 1 / -1;">
                        <p>No news articles found.</p>
                        <p style="font-size: 14px; margin-top: 10px;">Please add news articles through the admin dashboard.</p>
                    </div>
                `;
                return;
            }
            
            // Clear existing cards
            newsCategoriesGrid.innerHTML = '';
            
            // Sort by date (newest first)
            const sortedNews = [...newsArray].sort((a, b) => {
                return new Date(b.dateSort) - new Date(a.dateSort);
            });
            
            // Render cards
            sortedNews.forEach((news, index) => {
                const isActive = index === 0; // First card is active by default
                const card = document.createElement('div');
                // Fix image path - convert absolute Windows path to relative path
                let imagePath = news.image || news.imageUrl || '';
                
                // If path contains Windows absolute path, convert to relative
                if (imagePath.includes('C:\\') || imagePath.includes('C:/') || imagePath.includes('\\') || imagePath.includes('file://')) {
                    // Extract filename from absolute path
                    const filename = imagePath.split(/[/\\]/).pop();
                    
                    // Remove any query parameters or fragments
                    const cleanFilename = filename.split('?')[0].split('#')[0];
                    
                    // Map filename to correct image file
                    const imageMap = {
                        'UTeM-Aeronas.jpeg': 'UTEM.jpeg',
                        'UTEM.jpeg': 'UTEM.jpeg',
                        'KKTM.jpeg': 'KKTM.jpeg',
                        'USIM.jpeg': 'USIM.jpeg',
                        'UTHM.jpeg': 'UTHM.jpeg',
                        'GMI.jpeg': 'GMI.jpeg',
                        'CHEMTRON.jpeg': 'CHEMTRON.jpeg'
                    };
                    
                    const correctFilename = imageMap[cleanFilename] || cleanFilename;
                    imagePath = `assets/images/${correctFilename}`;
                }
                
                // Remove file:// protocol if present
                if (imagePath.includes('file://')) {
                    imagePath = imagePath.replace(/^file:\/\/\/?/, '');
                    // Extract just the filename
                    const filename = imagePath.split(/[/\\]/).pop();
                    const cleanFilename = filename.split('?')[0].split('#')[0];
                    imagePath = `assets/images/${cleanFilename}`;
                }
                
                // Ensure path is relative (starts with assets/)
                if (imagePath && !imagePath.startsWith('assets/') && !imagePath.startsWith('/assets/') && !imagePath.startsWith('./assets/') && !imagePath.startsWith('http') && !imagePath.startsWith('file://')) {
                    // If just filename, add assets/images/ prefix
                    if (!imagePath.includes('/')) {
                        imagePath = `assets/images/${imagePath}`;
                    } else {
                        // Extract filename from any path
                        const filename = imagePath.split(/[/\\]/).pop();
                        const cleanFilename = filename.split('?')[0].split('#')[0];
                        imagePath = `assets/images/${cleanFilename}`;
                    }
                }
                
                // Final cleanup - ensure no absolute paths
                if (imagePath.includes('C:\\') || imagePath.includes('C:/') || imagePath.includes('\\') || imagePath.includes('file://')) {
                    const filename = imagePath.split(/[/\\]/).pop();
                    const cleanFilename = filename.split('?')[0].split('#')[0];
                    imagePath = `assets/images/${cleanFilename}`;
                }
                
                card.className = `news-category-card ${isActive ? 'active' : ''}`;
                card.id = `news-${news.id}`;
                card.setAttribute('data-bg', imagePath);
                card.setAttribute('data-date', news.dateSort || news.date || '');
                card.setAttribute('data-title', news.title || 'Untitled');
                card.setAttribute('data-description', news.description || news.content || 'No description available');
                card.setAttribute('data-image', imagePath);
                
                card.innerHTML = `
                    <h3>${news.title || 'Untitled'}</h3>
                    <p>Date : ${news.date || 'No date'}</p>
                    <div class="news-popup-content">
                        <div class="news-popup-image">
                            <img src="${imagePath}" alt="${news.title || 'News image'}" onerror="this.style.display='none';">
                        </div>
                        <div class="news-popup-text">
                            <p>${news.description || news.content || 'No description available'}</p>
                        </div>
                    </div>
                `;
                
                // Removed console.log - images are loading correctly
                // Only log if there's an actual error (no image path)
                if (!imagePath) {
                    console.error(`News ${news.id}: No image path found!`);
                }
                
                newsCategoriesGrid.appendChild(card);
            });
            
            // Set initial background (desktop only, not mobile)
            if (window.innerWidth > 768 && sortedNews.length > 0 && sortedNews[0].image) {
                updateBackground(sortedNews[0].image);
            }
            
            // Setup event listeners for cards
            setupCardListeners();
            
            // Handle URL parameter
            const urlParams = new URLSearchParams(window.location.search);
            const newsId = urlParams.get('news');
            
            if (newsId) {
                setTimeout(() => {
                    const targetCard = document.getElementById(`news-${newsId}`);
                    if (targetCard) {
                        // Remove active from all cards
                        document.querySelectorAll('.news-category-card').forEach(c => c.classList.remove('active'));
                        // Add active to target card
                        targetCard.classList.add('active');
                        // Update background
                        const bgImage = targetCard.getAttribute('data-bg');
                        if (bgImage) {
                            updateBackground(bgImage);
                        }
                        // Scroll to card
                        targetCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }, 300);
            }
        }
        
        // Setup card event listeners
        function setupCardListeners() {
            const categoryCards = document.querySelectorAll('.news-category-card');
            const newsHeroSection = document.getElementById('newsHeroSection');
            const newsCategoriesSection = document.getElementById('newsCategoriesSection');
            const newsFullscreenView = document.getElementById('newsFullscreenView');
            const newsCloseBtn = document.getElementById('newsCloseBtn');
            const newsFullscreenImage = document.getElementById('newsFullscreenImage');
            const newsFullscreenText = document.getElementById('newsFullscreenText');

            // Check if mobile device - use function to check on each interaction
            function isMobileDevice() {
                return window.innerWidth <= 768;
            }
            
            categoryCards.forEach(card => {
                card.addEventListener('mouseenter', () => {
                    const newsHeroTitle = document.getElementById('newsHeroTitle');
                    const cardTitle = card.getAttribute('data-title') || '';
                    
                    // Update title text - ONLY on mobile (mobile layout sahaja)
                    if (isMobileDevice() && newsHeroTitle && cardTitle) {
                        newsHeroTitle.style.transition = 'opacity 0.3s ease';
                        newsHeroTitle.style.opacity = '0';
                        setTimeout(() => {
                            newsHeroTitle.textContent = cardTitle.toUpperCase();
                            newsHeroTitle.style.opacity = '1';
                        }, 200);
                    }
                    
                    // Desktop: background changes, title stays "NEWS"
                    if (!isMobileDevice()) {
                        const bgImage = card.getAttribute('data-bg');
                        if (bgImage) {
                            updateBackground(bgImage);
                        }
                        
                        // Remove active class from all cards
                        categoryCards.forEach(c => c.classList.remove('active'));
                        // Add active class to hovered card
                        card.classList.add('active');
                    }
                });
                
                card.addEventListener('mouseleave', () => {
                    // Reset news hero title - ONLY on mobile
                    if (isMobileDevice()) {
                        const newsHeroTitle = document.getElementById('newsHeroTitle');
                        if (newsHeroTitle) {
                            newsHeroTitle.style.transition = 'opacity 0.3s ease';
                            newsHeroTitle.style.opacity = '0';
                            setTimeout(() => {
                                newsHeroTitle.textContent = 'NEWS';
                                newsHeroTitle.style.opacity = '1';
                            }, 200);
                        }
                    }
                });

                // Click handler untuk fullscreen view
                card.addEventListener('click', () => {
                    // Get news data from card attributes
                    const cardTitle = card.getAttribute('data-title') || '';
                    const cardDescription = card.getAttribute('data-description') || '';
                    let cardImage = card.getAttribute('data-image') || card.getAttribute('data-bg') || '';
                    const cardDate = card.querySelector('p') ? card.querySelector('p').textContent : '';
                    
                    // Clean cardImage path before using
                    if (cardImage) {
                        cardImage = cardImage.trim();
                        // Remove file:// protocol if present
                        if (cardImage.includes('file://')) {
                            cardImage = cardImage.replace(/^file:\/\/\/?/, '');
                            const filename = cardImage.split(/[/\\]/).pop();
                            const cleanFilename = filename.split('?')[0].split('#')[0];
                            cardImage = `assets/images/${cleanFilename}`;
                        }
                        // Remove absolute Windows paths
                        if (cardImage.includes('C:\\') || cardImage.includes('C:/') || cardImage.includes('\\')) {
                            const filename = cardImage.split(/[/\\]/).pop();
                            const cleanFilename = filename.split('?')[0].split('#')[0];
                            cardImage = `assets/images/${cleanFilename}`;
                        }
                        // Ensure relative path
                        if (cardImage && !cardImage.startsWith('assets/') && !cardImage.startsWith('/assets/') && !cardImage.startsWith('./assets/') && !cardImage.startsWith('http') && !cardImage.startsWith('file://')) {
                            if (!cardImage.includes('/')) {
                                cardImage = `assets/images/${cardImage}`;
                            } else {
                                const filename = cardImage.split(/[/\\]/).pop();
                                const cleanFilename = filename.split('?')[0].split('#')[0];
                                cardImage = `assets/images/${cleanFilename}`;
                            }
                        }
                    }
                    
                    // For mobile: always show fullscreen, with or without image
                    // For desktop: only show if image exists
                    if (cardImage || isMobileDevice()) {
                        // Move title to side (desktop only)
                        if (!isMobileDevice()) {
                            newsHeroSection.classList.add('moved-to-side');
                            newsCategoriesSection.classList.add('moved-down');
                        }
                        
                        // Show fullscreen view dengan layout: image kiri, text kanan
                        if (cardImage) {
                            newsFullscreenImage.innerHTML = `<img src="${cardImage}" alt="${cardTitle}" onerror="this.style.display='none'; this.parentElement.style.backgroundColor='#2a2a2a';">`;
                        } else {
                            // No image - show dark gray background
                            newsFullscreenImage.innerHTML = '';
                            newsFullscreenImage.style.backgroundColor = '#2a2a2a';
                        }
                        newsFullscreenText.innerHTML = `
                            <h2 class="news-fullscreen-title">${cardTitle}</h2>
                            ${cardDate ? `<p class="news-fullscreen-date">${cardDate}</p>` : ''}
                            <div class="news-fullscreen-description">${cardDescription}</div>
                        `;
                        newsFullscreenView.classList.add('active');
                        
                        // Prevent scroll on body
                        document.body.style.overflow = 'hidden';
                    }
                });
            });

            // Close fullscreen view
            if (newsCloseBtn) {
                newsCloseBtn.addEventListener('click', () => {
                    newsFullscreenView.classList.remove('active');
                    // Only move sections on desktop
                    if (!isMobileDevice()) {
                        newsHeroSection.classList.remove('moved-to-side');
                        newsCategoriesSection.classList.remove('moved-down');
                    }
                    document.body.style.overflow = '';
                    // Reset image container background
                    newsFullscreenImage.style.backgroundColor = '';
                });
            }

            // Close on escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && newsFullscreenView.classList.contains('active')) {
                    newsFullscreenView.classList.remove('active');
                    // Only move sections on desktop
                    if (!isMobileDevice()) {
                        newsHeroSection.classList.remove('moved-to-side');
                        newsCategoriesSection.classList.remove('moved-down');
                    }
                    document.body.style.overflow = '';
                    // Reset image container background
                    newsFullscreenImage.style.backgroundColor = '';
                }
            });
            
        }
        
        // Load news from Firestore or use local data
        async function loadNews() {
            try {
                const news = await loadNewsFromFirestore();
                if (news && news.length > 0) {
                    renderNewsCards(news);
                } else {
                    // Fallback to local data
                    renderNewsCards(newsData);
                }
            } catch (error) {
                console.error('Error loading news:', error);
                // Fallback to local data
                renderNewsCards(newsData);
            }
        }
        
        // Initialize
        loadNews();
    </script>

    <script>
        // Mobile menu toggle
        const mobileMenuToggle = document.getElementById('mobileMenuToggle');
        const headerNav = document.getElementById('headerNav');
        const headerRight = document.querySelector('.header-right');

        if (mobileMenuToggle && headerNav) {
            mobileMenuToggle.addEventListener('click', function(e) {
                e.stopPropagation();
                mobileMenuToggle.classList.toggle('active');
                headerNav.classList.toggle('mobile-open');
                if (headerRight) {
                    headerRight.classList.toggle('mobile-open');
                }
                document.body.classList.toggle('menu-open');
            });

            // Close menu when clicking on any navigation link
            const navLinks = headerNav.querySelectorAll('a');
            navLinks.forEach(link => {
                link.addEventListener('click', function() {
                    mobileMenuToggle.classList.remove('active');
                    headerNav.classList.remove('mobile-open');
                    if (headerRight) {
                        headerRight.classList.remove('mobile-open');
                    }
                    document.body.classList.remove('menu-open');
                });
            });

            document.addEventListener('click', function(event) {
                if (!headerNav.contains(event.target) && !mobileMenuToggle.contains(event.target)) {
                    mobileMenuToggle.classList.remove('active');
                    headerNav.classList.remove('mobile-open');
                    if (headerRight) {
                        headerRight.classList.remove('mobile-open');
                    }
                    document.body.classList.remove('menu-open');
                }
            });
        }
    </script>
</body>
</html>


