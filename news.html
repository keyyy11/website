<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News – Aeronas Aerocraft</title>
    <link rel="icon" type="image/png" href="assets/images/Logo-Icon-Only.png">
    <link rel="shortcut icon" type="image/png" href="assets/images/Logo-Icon-Only.png">
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body class="theme-dark">
    <!-- Header (Otto-style navigation) -->
    <header class="site-header">
        <div class="header-left">
            <a href="index.html" class="brand-mark">
                <img src="assets/images/Logo-Icon-Only.png" alt="Logo" class="logo" />
                <span class="brand-text">Aeronas Aerocraft</span>
            </a>
        </div>

        <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Toggle menu">
            <span></span>
            <span></span>
            <span></span>
        </button>

        <nav class="header-nav" id="headerNav">
            <div class="mobile-nav-logo">
                <a href="index.html" class="brand-mark">
                    <img src="assets/images/Logo-Icon-Only.png" alt="Logo" class="logo">
                    <span class="brand-text">Aeronas Aerocraft</span>
                </a>
            </div>
            <a href="index.html">Home</a>
            <a href="aircraft.html" class="nav-mobile-aircraft">Aircraft</a>
            <div class="nav-dropdown">
            <a href="aircraft.html">Aircraft</a>
                <div class="dropdown-menu">
                    <a href="aircraft.html#manufacturing">Manufacturing</a>
                    <a href="technology.html">Technology</a>
                    <a href="compliance.html">Compliance</a>
                </div>
            </div>
            <a href="about.html">About</a>
            <a href="services.html">Careers</a>
            <a href="news.html" class="active">News</a>
            <!-- <a href="event.html">Event</a> -->
            <a href="contact.html" class="nav-mobile-contact">Contact Us</a>
        </nav>

        <div class="header-right">
            <a href="contact.html" class="nav-cta">Contact Us</a>
        </div>
    </header>

    <!-- Main Content -->
    <main class="news-page-main" id="newsPageMain">
        <div class="news-background-wrapper" id="newsBackground">
            <section class="news-hero-section" id="newsHeroSection">
                <div class="news-hero-content">
                    <p class="news-hero-label">ALL FIELDS OF APPLICATION</p>
                    <h1 class="news-hero-title" id="newsHeroTitle">NEWS</h1>
                </div>
            </section>

            <section class="news-categories-section" id="newsCategoriesSection">
                <div class="news-categories-grid" id="newsCategoriesGrid">
                    <!-- News cards will be loaded dynamically from Firestore or local data -->
                    <div style="text-align: center; padding: 40px; color: rgba(255,255,255,0.5);">
                        Loading news...
                    </div>
                </div>
            </section>
            
            <!-- Fullscreen News View -->
            <div class="news-fullscreen-view" id="newsFullscreenView">
                <button class="news-close-btn" id="newsCloseBtn">×</button>
                <div class="news-fullscreen-content">
                    <div class="news-fullscreen-image" id="newsFullscreenImage"></div>
                    <div class="news-fullscreen-text-wrapper">
                        <div class="news-fullscreen-text" id="newsFullscreenText"></div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="footer-content">
            <!-- Left Section: Branding & Social Media -->
            <div class="footer-col footer-brand">
                <div class="footer-logo">
                    <img src="assets/images/Logo-Icon-Only.png" alt="Logo" class="footer-logo-img">
                    <span class="footer-brand-text">Aeronas Aerocraft</span>
                </div>
                <p class="footer-description">Leading aerospace innovation and excellence in aircraft manufacturing, technology, and compliance solutions.</p>
                <div class="footer-social">
                    <a href="https://www.linkedin.com/in/aeronas-aerocraft-341b8939b" target="_blank" rel="noopener noreferrer" class="social-icon" aria-label="LinkedIn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/>
                        </svg>
                    </a>
                    <a href="https://www.instagram.com/aeronasaerocraft" target="_blank" rel="noopener noreferrer" class="social-icon" aria-label="Instagram">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                        </svg>
                    </a>
                    <a href="https://www.facebook.com/share/17ikZkTuhd/?mibextid=wwXIfr" target="_blank" rel="noopener noreferrer" class="social-icon" aria-label="Facebook">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                        </svg>
                    </a>
                </div>
            </div>

            <!-- Middle Section: Quick Links -->
            <div class="footer-col footer-links">
                <h4>Quick Links</h4>
                <ul class="footer-nav">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="about.html">About</a></li>
                    <li><a href="aircraft.html">Aircraft</a></li>
                    <li><a href="services.html">Careers</a></li>
                    <li><a href="news.html">News</a></li>
                    <li><a href="contact.html">Contact</a></li>
                </ul>
            </div>

            <!-- Right Section: Contact Info -->
            <div class="footer-col footer-contact-info">
                <h4>Get In Touch</h4>
                <ul class="footer-contact-list">
                    <li>
                        <div class="contact-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                            </svg>
                        </div>
                        <span>Malaysia</span>
                    </li>
                    <li>
                        <div class="contact-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/>
                            </svg>
                        </div>
                        <a href="tel:074450444">07-4450444</a>
                    </li>
                    <li>
                        <div class="contact-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                            </svg>
                        </div>
                        <a href="mailto:admin@aeronasgrp.com">admin@aeronasgrp.com</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>© 2025 Aeronas Aerocraft. All rights reserved.</p>
        </div>
    </footer>

    <script type="module">
        // Import Firebase functions
        import { loadNewsFromFirestore } from './assets/js/news-firebase.js';
        import { newsData } from './assets/js/news-data.js';
        
        // Dynamic background image change on hover
        const newsBackground = document.getElementById('newsBackground');
        const newsCategoriesGrid = document.querySelector('.news-categories-grid');
        
        // Function to update background image
        function updateBackground(imagePath) {
            if (newsBackground && imagePath) {
                // Clean image path - ensure it uses cleanImagePath if available, otherwise clean it here
                let cleanPath = imagePath.trim();
                
                // Remove file:// protocol if present
                if (cleanPath.includes('file://')) {
                    cleanPath = cleanPath.replace(/^file:\/\/\/?/, '');
                    const filename = cleanPath.split(/[/\\]/).pop();
                    const cleanFilename = filename.split('?')[0].split('#')[0];
                    cleanPath = `assets/images/${cleanFilename}`;
                }
                
                // Remove absolute Windows paths
                if (cleanPath.includes('C:\\') || cleanPath.includes('C:/') || cleanPath.includes('\\')) {
                    const filename = cleanPath.split(/[/\\]/).pop();
                    const cleanFilename = filename.split('?')[0].split('#')[0];
                    cleanPath = `assets/images/${cleanFilename}`;
                }
                
                // Remove quotes if present
                cleanPath = cleanPath.replace(/['"]/g, '');
                // Remove URL encoding
                cleanPath = cleanPath.replace(/%22/g, '').replace(/%20/g, ' ');
                
                // Ensure path is relative - handle plain filenames like "tengku.jpeg"
                if (cleanPath && !cleanPath.startsWith('assets/') && !cleanPath.startsWith('/assets/') && !cleanPath.startsWith('./assets/') && !cleanPath.startsWith('http') && !cleanPath.startsWith('file://')) {
                    if (!cleanPath.includes('/')) {
                        // Plain filename like "tengku.jpeg" - add assets/images/ prefix
                        cleanPath = `assets/images/${cleanPath}`;
                    } else {
                        const filename = cleanPath.split(/[/\\]/).pop();
                        const cleanFilename = filename.split('?')[0].split('#')[0];
                        cleanPath = `assets/images/${cleanFilename}`;
                    }
                }
                
                // Final cleanup - ensure no absolute paths
                if (cleanPath.includes('C:\\') || cleanPath.includes('C:/') || cleanPath.includes('\\') || cleanPath.includes('file://')) {
                    const filename = cleanPath.split(/[/\\]/).pop();
                    const cleanFilename = filename.split('?')[0].split('#')[0];
                    cleanPath = `assets/images/${cleanFilename}`;
                }
                
                if (cleanPath.includes('%')) {
                    try {
                        cleanPath = decodeURIComponent(cleanPath);
                    } catch (e) {
                        // Image path decode failed - silently handle
                    }
                }
                
                // Create or update style element for background
                let style = document.getElementById('news-bg-dynamic');
                if (!style) {
                    style = document.createElement('style');
                    style.id = 'news-bg-dynamic';
                    document.head.appendChild(style);
                }
                // Escape single quotes in path
                const escapedPath = cleanPath.replace(/'/g, "\\'");
                style.textContent = `.news-background-wrapper::after { background-image: url('${escapedPath}') !important; background-size: cover !important; background-position: center !important; transition: background-image 2s ease-in-out !important; }`;
                // Background updated successfully
            }
        }
        
        // Auto-slide functionality for desktop
        let autoSlideInterval = null;
        let newsImages = [];
        let isPaused = false;
        let currentRandomImage = null;
        
        // Helper function to clean image path (same as renderNewsCards)
        function cleanImagePath(imagePath) {
            if (!imagePath) return '';
            
            // If path contains Windows absolute path, convert to relative
            if (imagePath.includes('C:\\') || imagePath.includes('C:/') || imagePath.includes('\\') || imagePath.includes('file://')) {
                const filename = imagePath.split(/[/\\]/).pop();
                const cleanFilename = filename.split('?')[0].split('#')[0];
                
                // Map filename to correct image file
                const imageMap = {
                    'UTeM-Aeronas.jpeg': 'UTEM.jpeg',
                    'UTEM.jpeg': 'UTEM.jpeg',
                    'KKTM.jpeg': 'KKTM.jpeg',
                    'USIM.jpeg': 'USIM.jpeg',
                    'UTHM.jpeg': 'UTHM.jpeg',
                    'GMI.jpeg': 'GMI.jpeg',
                    'CHEMTRON.jpeg': 'CHEMTRON.jpeg',
                    'tengku.jpeg': 'tengku.jpeg'
                };
                
                const correctFilename = imageMap[cleanFilename] || cleanFilename;
                imagePath = `assets/images/${correctFilename}`;
            }
            
            // Remove file:// protocol if present
            if (imagePath.includes('file://')) {
                imagePath = imagePath.replace(/^file:\/\/\/?/, '');
                const filename = imagePath.split(/[/\\]/).pop();
                const cleanFilename = filename.split('?')[0].split('#')[0];
                imagePath = `assets/images/${cleanFilename}`;
            }
            
            // Ensure path is relative (starts with assets/)
            if (imagePath && !imagePath.startsWith('assets/') && !imagePath.startsWith('/assets/') && !imagePath.startsWith('./assets/') && !imagePath.startsWith('http') && !imagePath.startsWith('file://')) {
                if (!imagePath.includes('/')) {
                    imagePath = `assets/images/${imagePath}`;
                } else {
                    const filename = imagePath.split(/[/\\]/).pop();
                    const cleanFilename = filename.split('?')[0].split('#')[0];
                    imagePath = `assets/images/${cleanFilename}`;
                }
            }
            
            // Final cleanup - ensure no absolute paths
            if (imagePath.includes('C:\\') || imagePath.includes('C:/') || imagePath.includes('\\') || imagePath.includes('file://')) {
                const filename = imagePath.split(/[/\\]/).pop();
                const cleanFilename = filename.split('?')[0].split('#')[0];
                imagePath = `assets/images/${cleanFilename}`;
            }
            
            return imagePath;
        }
        
        function startAutoSlide(newsArray) {
            // Only run on desktop
            if (window.innerWidth <= 768) {
                return;
            }
            
            // Clear existing interval
            if (autoSlideInterval) {
                clearInterval(autoSlideInterval);
            }
            
            // Get all news images using same logic as renderNewsCards
            newsImages = newsArray
                .map(news => {
                    const imagePath = news.image || news.imageUrl || '';
                    return cleanImagePath(imagePath);
                })
                .filter(imagePath => imagePath && imagePath.startsWith('assets/'));
            
            // If no images, don't start auto-slide
            if (newsImages.length === 0) {
                return;
            }
            
            // Function to get random image (avoid same image consecutively)
            function getRandomImage() {
                if (newsImages.length === 1) {
                    return newsImages[0];
                }
                
                let randomImage;
                do {
                    const randomIndex = Math.floor(Math.random() * newsImages.length);
                    randomImage = newsImages[randomIndex];
                } while (randomImage === currentRandomImage && newsImages.length > 1);
                
                currentRandomImage = randomImage;
                return randomImage;
            }
            
            // Auto-slide every 5 seconds with random selection
            autoSlideInterval = setInterval(() => {
                if (!isPaused && window.innerWidth > 768) {
                    const randomImage = getRandomImage();
                    updateBackground(randomImage);
                }
            }, 5000); // 5 seconds per slide
        }
        
        function stopAutoSlide() {
            if (autoSlideInterval) {
                clearInterval(autoSlideInterval);
                autoSlideInterval = null;
            }
        }
        
        function pauseAutoSlide() {
            isPaused = true;
        }
        
        function resumeAutoSlide() {
            isPaused = false;
        }
        
        // Function to render news cards
        function renderNewsCards(newsArray) {
            if (!newsCategoriesGrid) {
                console.error('News categories grid not found');
                return;
            }
            
            if (!newsArray || newsArray.length === 0) {
                newsCategoriesGrid.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: rgba(255,255,255,0.5); grid-column: 1 / -1;">
                        <p>No news articles found.</p>
                        <p style="font-size: 14px; margin-top: 10px;">Please add news articles through the admin dashboard.</p>
                    </div>
                `;
                return;
            }
            
            // Clear existing cards
            newsCategoriesGrid.innerHTML = '';
            
            // Sort by date (newest first)
            const sortedNews = [...newsArray].sort((a, b) => {
                return new Date(b.dateSort) - new Date(a.dateSort);
            });
            
            // Render cards
            sortedNews.forEach((news, index) => {
                const isActive = index === 0; // First card is active by default
                const card = document.createElement('div');
                // Fix image path - convert absolute Windows path to relative path
                let imagePath = news.image || news.imageUrl || '';
                
                // If path contains Windows absolute path, convert to relative
                if (imagePath.includes('C:\\') || imagePath.includes('C:/') || imagePath.includes('\\') || imagePath.includes('file://')) {
                    // Extract filename from absolute path
                    const filename = imagePath.split(/[/\\]/).pop();
                    
                    // Remove any query parameters or fragments
                    const cleanFilename = filename.split('?')[0].split('#')[0];
                    
                    // Map filename to correct image file
                    const imageMap = {
                        'UTeM-Aeronas.jpeg': 'UTEM.jpeg',
                        'UTEM.jpeg': 'UTEM.jpeg',
                        'KKTM.jpeg': 'KKTM.jpeg',
                        'USIM.jpeg': 'USIM.jpeg',
                        'UTHM.jpeg': 'UTHM.jpeg',
                        'GMI.jpeg': 'GMI.jpeg',
                        'CHEMTRON.jpeg': 'CHEMTRON.jpeg',
                        'tengku.jpeg': 'tengku.jpeg'
                    };
                    
                    const correctFilename = imageMap[cleanFilename] || cleanFilename;
                    imagePath = `assets/images/${correctFilename}`;
                }
                
                // Remove file:// protocol if present
                if (imagePath.includes('file://')) {
                    imagePath = imagePath.replace(/^file:\/\/\/?/, '');
                    // Extract just the filename
                    const filename = imagePath.split(/[/\\]/).pop();
                    const cleanFilename = filename.split('?')[0].split('#')[0];
                    imagePath = `assets/images/${cleanFilename}`;
                }
                
                // Ensure path is relative (starts with assets/)
                if (imagePath && !imagePath.startsWith('assets/') && !imagePath.startsWith('/assets/') && !imagePath.startsWith('./assets/') && !imagePath.startsWith('http') && !imagePath.startsWith('file://')) {
                    // If just filename, add assets/images/ prefix
                    if (!imagePath.includes('/')) {
                        // Check imageMap for correct filename mapping
                        const imageMapForFilename = {
                            'UTeM-Aeronas.jpeg': 'UTEM.jpeg',
                            'UTEM.jpeg': 'UTEM.jpeg',
                            'KKTM.jpeg': 'KKTM.jpeg',
                            'USIM.jpeg': 'USIM.jpeg',
                            'UTHM.jpeg': 'UTHM.jpeg',
                            'GMI.jpeg': 'GMI.jpeg',
                            'GMI.Jpeg': 'GMI.jpeg',
                            'GMI.JPEG': 'GMI.jpeg',
                            'CHEMTRON.jpeg': 'CHEMTRON.jpeg',
                            'CHEMTRON.Jpeg': 'CHEMTRON.jpeg',
                            'tengku.jpeg': 'tengku.jpeg'
                        };
                        const correctFilename = imageMapForFilename[imagePath] || imagePath;
                        imagePath = `assets/images/${correctFilename}`;
                    } else {
                        // Extract filename from any path
                        const filename = imagePath.split(/[/\\]/).pop();
                        const cleanFilename = filename.split('?')[0].split('#')[0];
                        
                        // Check imageMap for correct filename mapping
                        const imageMapForFilename = {
                            'UTeM-Aeronas.jpeg': 'UTEM.jpeg',
                            'UTEM.jpeg': 'UTEM.jpeg',
                            'KKTM.jpeg': 'KKTM.jpeg',
                            'USIM.jpeg': 'USIM.jpeg',
                            'UTHM.jpeg': 'UTHM.jpeg',
                            'GMI.jpeg': 'GMI.jpeg',
                            'GMI.Jpeg': 'GMI.jpeg',
                            'GMI.JPEG': 'GMI.jpeg',
                            'CHEMTRON.jpeg': 'CHEMTRON.jpeg',
                            'CHEMTRON.Jpeg': 'CHEMTRON.jpeg',
                            'tengku.jpeg': 'tengku.jpeg'
                        };
                        const correctFilename = imageMapForFilename[cleanFilename] || cleanFilename;
                        imagePath = `assets/images/${correctFilename}`;
                    }
                }
                
                // Final cleanup - ensure no absolute paths
                if (imagePath.includes('C:\\') || imagePath.includes('C:/') || imagePath.includes('\\') || imagePath.includes('file://')) {
                    const filename = imagePath.split(/[/\\]/).pop();
                    const cleanFilename = filename.split('?')[0].split('#')[0];
                    
                    // Check imageMap for correct filename mapping
                    const imageMapForFilename = {
                        'UTeM-Aeronas.jpeg': 'UTEM.jpeg',
                        'UTEM.jpeg': 'UTEM.jpeg',
                        'KKTM.jpeg': 'KKTM.jpeg',
                        'USIM.jpeg': 'USIM.jpeg',
                        'UTHM.jpeg': 'UTHM.jpeg',
                        'GMI.jpeg': 'GMI.jpeg',
                        'GMI.Jpeg': 'GMI.jpeg',
                        'GMI.JPEG': 'GMI.jpeg',
                        'CHEMTRON.jpeg': 'CHEMTRON.jpeg',
                        'CHEMTRON.Jpeg': 'CHEMTRON.jpeg',
                        'tengku.jpeg': 'tengku.jpeg'
                    };
                    const correctFilename = imageMapForFilename[cleanFilename] || cleanFilename;
                    imagePath = `assets/images/${correctFilename}`;
                }
                
                // Final validation - ensure GMI uses correct image
                if (news.id === 'gmi' || news.title?.toLowerCase().includes('gmi')) {
                    imagePath = 'assets/images/GMI.jpeg';
                    console.log(`News ${news.id}: Force GMI image path to assets/images/GMI.jpeg`);
                }
                
                card.className = `news-category-card ${isActive ? 'active' : ''}`;
                card.id = `news-${news.id}`;
                card.setAttribute('data-bg', imagePath);
                card.setAttribute('data-date', news.dateSort || news.date || '');
                card.setAttribute('data-title', news.title || 'Untitled');
                card.setAttribute('data-description', news.description || news.content || 'No description available');
                card.setAttribute('data-image', imagePath);
                
                card.innerHTML = `
                    <h3>${news.title || 'Untitled'}</h3>
                    <p>Date : ${news.date || 'No date'}</p>
                    <div class="news-popup-content">
                        <div class="news-popup-image">
                            <img src="${imagePath}" alt="${news.title || 'News image'}" onerror="this.style.display='none';">
                        </div>
                        <div class="news-popup-text">
                            <p>${news.description || news.content || 'No description available'}</p>
                        </div>
                    </div>
                `;
                
                // Removed console.log - images are loading correctly
                // Only log if there's an actual error (no image path)
                if (!imagePath) {
                    console.error(`News ${news.id}: No image path found!`);
                }
                
                newsCategoriesGrid.appendChild(card);
            });
            
            // Start auto-slide for desktop (will set random initial background)
            if (window.innerWidth > 768) {
                startAutoSlide(sortedNews);
                // Set initial random background immediately
                if (newsImages.length > 0) {
                    const randomIndex = Math.floor(Math.random() * newsImages.length);
                    currentRandomImage = newsImages[randomIndex];
                    updateBackground(currentRandomImage);
                }
            } else if (window.innerWidth > 768 && sortedNews.length > 0 && sortedNews[0].image) {
                // Fallback: use first image if auto-slide didn't set it
                updateBackground(sortedNews[0].image);
            }
            
            // Setup event listeners for cards
            setupCardListeners();
            
            // Handle URL parameter
            const urlParams = new URLSearchParams(window.location.search);
            const newsId = urlParams.get('news');
            
            if (newsId) {
                setTimeout(() => {
                    const targetCard = document.getElementById(`news-${newsId}`);
                    if (targetCard) {
                        // Remove active from all cards
                        document.querySelectorAll('.news-category-card').forEach(c => c.classList.remove('active'));
                        // Add active to target card
                        targetCard.classList.add('active');
                        // Update background
                        const bgImage = targetCard.getAttribute('data-bg');
                        if (bgImage) {
                            updateBackground(bgImage);
                        }
                        // Scroll to card
                        targetCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }, 300);
            }
        }
        
        // Setup card event listeners
        function setupCardListeners() {
            const categoryCards = document.querySelectorAll('.news-category-card');
            const newsHeroSection = document.getElementById('newsHeroSection');
            const newsCategoriesSection = document.getElementById('newsCategoriesSection');
            const newsFullscreenView = document.getElementById('newsFullscreenView');
            const newsCloseBtn = document.getElementById('newsCloseBtn');
            const newsFullscreenImage = document.getElementById('newsFullscreenImage');
            const newsFullscreenText = document.getElementById('newsFullscreenText');

            // Check if mobile device - use function to check on each interaction
            function isMobileDevice() {
                return window.innerWidth <= 768;
            }

        categoryCards.forEach(card => {
            card.addEventListener('mouseenter', () => {
                    const newsHeroTitle = document.getElementById('newsHeroTitle');
                    const cardTitle = card.getAttribute('data-title') || '';
                    
                    // Update title text - ONLY on mobile (mobile layout sahaja)
                    if (isMobileDevice() && newsHeroTitle && cardTitle) {
                        newsHeroTitle.style.transition = 'opacity 0.3s ease';
                        newsHeroTitle.style.opacity = '0';
                        setTimeout(() => {
                            newsHeroTitle.textContent = cardTitle.toUpperCase();
                            newsHeroTitle.style.opacity = '1';
                        }, 200);
                    }
                    
                    // Desktop: background changes, title stays "NEWS"
                    if (!isMobileDevice()) {
                        // Pause auto-slide on hover
                        pauseAutoSlide();
                        
                const bgImage = card.getAttribute('data-bg');
                if (bgImage) {
                    updateBackground(bgImage);
                }
                        
                // Remove active class from all cards
                categoryCards.forEach(c => c.classList.remove('active'));
                // Add active class to hovered card
                card.classList.add('active');
                    }
                });
                
                card.addEventListener('mouseleave', () => {
                    // Reset news hero title - ONLY on mobile
                    if (isMobileDevice()) {
                        const newsHeroTitle = document.getElementById('newsHeroTitle');
                        if (newsHeroTitle) {
                            newsHeroTitle.style.transition = 'opacity 0.3s ease';
                            newsHeroTitle.style.opacity = '0';
                            setTimeout(() => {
                                newsHeroTitle.textContent = 'NEWS';
                                newsHeroTitle.style.opacity = '1';
                            }, 200);
                        }
                    } else {
                        // Resume auto-slide on desktop when mouse leaves
                        resumeAutoSlide();
                        // Immediately show a random image when resuming
                        if (newsImages.length > 0) {
                            const randomIndex = Math.floor(Math.random() * newsImages.length);
                            currentRandomImage = newsImages[randomIndex];
                            updateBackground(currentRandomImage);
                        }
                    }
                });

                // Click handler untuk fullscreen view
                card.addEventListener('click', () => {
                    // Get news data from card attributes
                    const cardTitle = card.getAttribute('data-title') || '';
                    const cardDescription = card.getAttribute('data-description') || '';
                    let cardImage = card.getAttribute('data-image') || card.getAttribute('data-bg') || '';
                    const cardDate = card.querySelector('p') ? card.querySelector('p').textContent : '';
                    
                    // Clean cardImage path before using
                    if (cardImage) {
                        cardImage = cardImage.trim();
                        // Remove file:// protocol if present
                        if (cardImage.includes('file://')) {
                            cardImage = cardImage.replace(/^file:\/\/\/?/, '');
                            const filename = cardImage.split(/[/\\]/).pop();
                            const cleanFilename = filename.split('?')[0].split('#')[0];
                            cardImage = `assets/images/${cleanFilename}`;
                        }
                        // Remove absolute Windows paths
                        if (cardImage.includes('C:\\') || cardImage.includes('C:/') || cardImage.includes('\\')) {
                            const filename = cardImage.split(/[/\\]/).pop();
                            const cleanFilename = filename.split('?')[0].split('#')[0];
                            cardImage = `assets/images/${cleanFilename}`;
                        }
                        // Ensure relative path
                        if (cardImage && !cardImage.startsWith('assets/') && !cardImage.startsWith('/assets/') && !cardImage.startsWith('./assets/') && !cardImage.startsWith('http') && !cardImage.startsWith('file://')) {
                            if (!cardImage.includes('/')) {
                                cardImage = `assets/images/${cardImage}`;
                            } else {
                                const filename = cardImage.split(/[/\\]/).pop();
                                const cleanFilename = filename.split('?')[0].split('#')[0];
                                cardImage = `assets/images/${cleanFilename}`;
                            }
                        }
                    }
                    
                    // For mobile: always show fullscreen, with or without image
                    // For desktop: only show if image exists
                    if (cardImage || isMobileDevice()) {
                        // Move title to side (desktop only)
                        if (!isMobileDevice()) {
                            newsHeroSection.classList.add('moved-to-side');
                            newsCategoriesSection.classList.add('moved-down');
                        }
                        
                        // Show fullscreen view dengan layout: image kiri, text kanan
                        if (cardImage) {
                            newsFullscreenImage.innerHTML = `<img src="${cardImage}" alt="${cardTitle}" onerror="this.style.display='none'; this.parentElement.style.backgroundColor='#2a2a2a';">`;
                        } else {
                            // No image - show dark gray background
                            newsFullscreenImage.innerHTML = '';
                            newsFullscreenImage.style.backgroundColor = '#2a2a2a';
                        }
                        newsFullscreenText.innerHTML = `
                            <h2 class="news-fullscreen-title">${cardTitle}</h2>
                            ${cardDate ? `<p class="news-fullscreen-date">${cardDate}</p>` : ''}
                            <div class="news-fullscreen-description">${cardDescription}</div>
                        `;
                        newsFullscreenView.classList.add('active');
                        
                        // Prevent scroll on body
                        document.body.style.overflow = 'hidden';
                    }
                });
            });

            // Close fullscreen view
            if (newsCloseBtn) {
                newsCloseBtn.addEventListener('click', () => {
                    newsFullscreenView.classList.remove('active');
                    // Only move sections on desktop
                    if (!isMobileDevice()) {
                        newsHeroSection.classList.remove('moved-to-side');
                        newsCategoriesSection.classList.remove('moved-down');
                    }
                    document.body.style.overflow = '';
                    // Reset image container background
                    newsFullscreenImage.style.backgroundColor = '';
                });
            }

            // Close on escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && newsFullscreenView.classList.contains('active')) {
                    newsFullscreenView.classList.remove('active');
                    // Only move sections on desktop
                    if (!isMobileDevice()) {
                        newsHeroSection.classList.remove('moved-to-side');
                        newsCategoriesSection.classList.remove('moved-down');
                    }
                    document.body.style.overflow = '';
                    // Reset image container background
                    newsFullscreenImage.style.backgroundColor = '';
                }
            });
            
        }
        
        // Load news from Firestore or use local data
        async function loadNews() {
            try {
                const news = await loadNewsFromFirestore();
                if (news && news.length > 0) {
                    renderNewsCards(news);
                } else {
                    // Fallback to local data
                    renderNewsCards(newsData);
                }
            } catch (error) {
                console.error('Error loading news:', error);
                // Fallback to local data
                renderNewsCards(newsData);
            }
        }
        
        // Handle window resize
        window.addEventListener('resize', () => {
            if (window.innerWidth > 768) {
                // Reload news to restart auto-slide if needed
                loadNews();
            } else {
                stopAutoSlide();
            }
        });
        
        // Initialize
        loadNews();
    </script>

    <script>
        // Mobile menu toggle
        const mobileMenuToggle = document.getElementById('mobileMenuToggle');
        const headerNav = document.getElementById('headerNav');
        const headerRight = document.querySelector('.header-right');

        if (mobileMenuToggle && headerNav) {
            mobileMenuToggle.addEventListener('click', function(e) {
                e.stopPropagation();
                mobileMenuToggle.classList.toggle('active');
                headerNav.classList.toggle('mobile-open');
                if (headerRight) {
                    headerRight.classList.toggle('mobile-open');
                }
                document.body.classList.toggle('menu-open');
            });

            // Close menu when clicking on any navigation link
            const navLinks = headerNav.querySelectorAll('a');
            navLinks.forEach(link => {
                link.addEventListener('click', function() {
                    mobileMenuToggle.classList.remove('active');
                    headerNav.classList.remove('mobile-open');
                    if (headerRight) {
                        headerRight.classList.remove('mobile-open');
                    }
                    document.body.classList.remove('menu-open');
                });
            });

            document.addEventListener('click', function(event) {
                if (!headerNav.contains(event.target) && !mobileMenuToggle.contains(event.target)) {
                    mobileMenuToggle.classList.remove('active');
                    headerNav.classList.remove('mobile-open');
                    if (headerRight) {
                        headerRight.classList.remove('mobile-open');
                    }
                    document.body.classList.remove('menu-open');
                }
            });
        }
    </script>
</body>
</html>


